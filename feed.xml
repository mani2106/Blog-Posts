<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="4.3.4">Jekyll</generator><link href="https://mani2106.github.io/Blog-Posts/feed.xml" rel="self" type="application/atom+xml" /><link href="https://mani2106.github.io/Blog-Posts/" rel="alternate" type="text/html" /><updated>2025-11-08T08:02:10+00:00</updated><id>https://mani2106.github.io/Blog-Posts/feed.xml</id><title type="html">Manimaran Panneerselvamâ€™s blog</title><subtitle>This is where I write about my work on data science. I will also post Notebooks and sample codes to solve some interesting problems that I face everyday.</subtitle><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><entry><title type="html">Building a Sticky Table of Contents: From Spec to Implementation</title><link href="https://mani2106.github.io/Blog-Posts/web-development/jekyll/ux/accessibility/spec-driven-development/css/javascript/2025/10/04/sticky-toc-component-implementation.html" rel="alternate" type="text/html" title="Building a Sticky Table of Contents: From Spec to Implementation" /><published>2025-10-04T00:00:00+00:00</published><updated>2025-10-04T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/web-development/jekyll/ux/accessibility/spec-driven-development/css/javascript/2025/10/04/sticky-toc-component-implementation</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/web-development/jekyll/ux/accessibility/spec-driven-development/css/javascript/2025/10/04/sticky-toc-component-implementation.html"><![CDATA[<h1 id="transforming-blog-navigation-the-sticky-toc-journey">Transforming Blog Navigation: The Sticky TOC Journey</h1>

<p>Reading long-form technical content can be challenging without proper navigation aids. When I noticed the empty right sidebar space on my Jekyll blog posts, I saw an opportunity to dramatically improve the reading experience by implementing a sticky table of contents (TOC) component. This post documents the complete journey from initial concept to production implementation using spec-driven development methodology.</p>

<h2 id="the-problem-lost-in-long-content">The Problem: Lost in Long Content</h2>

<p>My blog posts often contain detailed technical discussions with multiple sections and subsections. Readers would frequently lose their place or struggle to navigate to specific sections without scrolling back to find headers. The existing TOC implementation was basic and not optimally positioned, failing to provide the navigation assistance readers needed.</p>

<h3 id="user-experience-pain-points">User Experience Pain Points</h3>
<ul>
  <li><strong>No persistent navigation</strong>: Readers had to scroll to find section headers</li>
  <li><strong>Wasted screen real estate</strong>: Empty right sidebar on desktop screens</li>
  <li><strong>Poor mobile experience</strong>: No responsive behavior for smaller screens</li>
  <li><strong>Accessibility gaps</strong>: Limited screen reader support and keyboard navigation</li>
  <li><strong>Inconsistent styling</strong>: TOC didnâ€™t match the blogâ€™s design system</li>
</ul>

<h2 id="the-spec-driven-approach">The Spec-Driven Approach</h2>

<p>Rather than diving straight into code, I used Kiroâ€™s spec-driven development methodology to systematically transform this idea into a comprehensive feature. This approach proved invaluable for managing complexity and ensuring nothing was overlooked.</p>

<h3 id="why-spec-driven-development">Why Spec-Driven Development?</h3>

<p>The systematic approach provided several key benefits:</p>
<ul>
  <li><strong>Clear requirements</strong>: Defined exactly what needed to be built and why</li>
  <li><strong>Comprehensive design</strong>: Identified technical challenges and solutions upfront</li>
  <li><strong>Actionable tasks</strong>: Broke down complex implementation into manageable steps</li>
  <li><strong>Quality assurance</strong>: Built-in validation and testing strategies</li>
  <li><strong>Future maintenance</strong>: Documented decisions and procedures for ongoing updates</li>
</ul>

<h2 id="phase-1-requirements-gathering">Phase 1: Requirements Gathering</h2>

<p>The first phase involved creating detailed requirements using the EARS format (Easy Approach to Requirements Syntax). This systematic approach helped identify all the necessary functionality and edge cases.</p>

<h3 id="core-user-stories">Core User Stories</h3>

<p><strong>Navigation Enhancement</strong></p>
<blockquote>
  <p>As a blog reader, I want to see a sticky table of contents on the right side of blog posts, so that I can quickly navigate to different sections without scrolling back to the top.</p>
</blockquote>

<p><strong>Automatic Generation</strong></p>
<blockquote>
  <p>As a blog reader, I want the table of contents to automatically generate from the post headers, so that I can see the hierarchical structure of the content.</p>
</blockquote>

<p><strong>Interactive Navigation</strong></p>
<blockquote>
  <p>As a blog reader, I want to click on TOC entries to jump to specific sections, so that I can quickly navigate to content that interests me.</p>
</blockquote>

<h3 id="acceptance-criteria-highlights">Acceptance Criteria Highlights</h3>

<p>The requirements phase established critical acceptance criteria:</p>

<ol>
  <li><strong>Responsive Behavior</strong>: TOC displays on desktop (&gt;1024px) but hides on mobile/tablet</li>
  <li><strong>Content Threshold</strong>: TOC only appears when posts have 2+ headers</li>
  <li><strong>Sticky Positioning</strong>: TOC remains visible during scroll with proper offset</li>
  <li><strong>Active Highlighting</strong>: Current section highlighted based on scroll position</li>
  <li><strong>Accessibility</strong>: Full keyboard navigation and screen reader support</li>
  <li><strong>Performance</strong>: Smooth scrolling and 60fps scroll performance</li>
</ol>

<h2 id="phase-2-technical-design">Phase 2: Technical Design</h2>

<p>The design phase involved researching the existing Jekyll setup and creating a comprehensive technical architecture that would integrate seamlessly with the current blog infrastructure.</p>

<h3 id="architecture-overview">Architecture Overview</h3>

<p>The solution consists of three main components working together:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Post Header                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                 â”‚                                       â”‚
â”‚   Sticky TOC    â”‚           Main Content                â”‚
â”‚   (Left Side)   â”‚           (Blog Post)                 â”‚
â”‚                 â”‚                                       â”‚
â”‚   - Auto-gen    â”‚   - Headers (H1-H6)                  â”‚
â”‚   - Clickable   â”‚   - Paragraphs                       â”‚
â”‚   - Highlighted â”‚   - Images, etc.                      â”‚
â”‚                 â”‚                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    Comments Section                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div></div>

<h3 id="key-design-decisions">Key Design Decisions</h3>

<p><strong>CSS Grid Layout</strong>: Chose CSS Grid for the main layout with graceful degradation to flexbox for older browsers.</p>

<p><strong>Intersection Observer API</strong>: Selected for active section highlighting due to superior performance compared to scroll event handlers.</p>

<p><strong>Progressive Enhancement</strong>: Built with fallbacks at every level - from jQuery TOC plugin to vanilla JavaScript, from CSS Grid to float-based layout.</p>

<p><strong>Responsive Strategy</strong>: Hide TOC completely on screens &lt;1024px rather than trying to fit it in limited space.</p>

<h2 id="phase-3-implementation-planning">Phase 3: Implementation Planning</h2>

<p>The design was broken down into 8 major implementation phases with 15 specific coding tasks. Each task included clear acceptance criteria and requirement references.</p>

<h3 id="task-breakdown-strategy">Task Breakdown Strategy</h3>

<ol>
  <li><strong>Foundation First</strong>: CSS layout and responsive behavior</li>
  <li><strong>Core Functionality</strong>: TOC generation and basic navigation</li>
  <li><strong>Enhanced Features</strong>: Active highlighting and smooth scrolling</li>
  <li><strong>Polish &amp; Performance</strong>: Styling, optimization, and cross-browser testing</li>
  <li><strong>Documentation</strong>: Comprehensive testing and user documentation</li>
</ol>

<h2 id="implementation-deep-dive">Implementation Deep Dive</h2>

<h3 id="css-grid-layout-foundation">CSS Grid Layout Foundation</h3>

<p>The layout system uses CSS Grid with comprehensive fallbacks:</p>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.post-container</span> <span class="p">{</span>
  <span class="nl">display</span><span class="p">:</span> <span class="nb">grid</span><span class="p">;</span>
  <span class="nl">grid-template-columns</span><span class="p">:</span> <span class="m">280px</span> <span class="m">1fr</span><span class="p">;</span> <span class="c1">// TOC width + Main content</span>
  <span class="na">grid-gap</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
  <span class="nl">max-width</span><span class="p">:</span> <span class="m">1200px</span><span class="p">;</span>
  <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>

  <span class="c1">// Cross-browser grid support</span>
  <span class="na">-ms-grid-columns</span><span class="p">:</span> <span class="m">280px</span> <span class="m">2rem</span> <span class="m">1fr</span><span class="p">;</span>
  <span class="na">-ms-grid-rows</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>

  <span class="c1">// Graceful degradation for browsers without CSS Grid</span>
  <span class="k">&amp;</span><span class="nc">.no-css-grid</span> <span class="p">{</span>
    <span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>

    <span class="nc">.toc-sidebar</span> <span class="p">{</span>
      <span class="nl">float</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span>
      <span class="nl">width</span><span class="p">:</span> <span class="m">280px</span><span class="p">;</span>
      <span class="nl">margin-right</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nc">.post-main</span> <span class="p">{</span>
      <span class="nl">margin-left</span><span class="p">:</span> <span class="m">312px</span><span class="p">;</span> <span class="c1">// 280px + 2rem gap</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// Responsive behavior - hide TOC on smaller screens</span>
  <span class="k">@media</span> <span class="p">(</span><span class="n">max-width</span><span class="o">:</span> <span class="m">1024px</span><span class="p">)</span> <span class="p">{</span>
    <span class="nl">grid-template-columns</span><span class="p">:</span> <span class="m">1fr</span><span class="p">;</span> <span class="c1">// Single column layout</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="sticky-positioning-with-fallbacks">Sticky Positioning with Fallbacks</h3>

<p>The sticky positioning includes comprehensive browser support:</p>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.toc-sidebar</span> <span class="p">{</span>
  <span class="nl">position</span><span class="p">:</span> <span class="o">-</span><span class="n">webkit-sticky</span><span class="p">;</span> <span class="c1">// Safari support</span>
  <span class="nl">position</span><span class="p">:</span> <span class="nb">sticky</span><span class="p">;</span>
  <span class="nl">top</span><span class="p">:</span> <span class="m">2rem</span><span class="p">;</span>
  <span class="nl">height</span><span class="p">:</span> <span class="n">fit-content</span><span class="p">;</span>
  <span class="nl">max-height</span><span class="p">:</span> <span class="nf">calc</span><span class="p">(</span><span class="m">100vh</span> <span class="o">-</span> <span class="m">4rem</span><span class="p">);</span>
  <span class="nl">overflow-y</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>

  <span class="c1">// Performance optimization: Hardware acceleration</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="nf">translateZ</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
  <span class="nl">backface-visibility</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>

  <span class="c1">// Graceful degradation for browsers without sticky positioning</span>
  <span class="k">&amp;</span><span class="nc">.no-sticky-position</span> <span class="p">{</span>
    <span class="nl">position</span><span class="p">:</span> <span class="nb">static</span><span class="p">;</span>
    <span class="nl">max-height</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="javascript-enhancement-architecture">JavaScript Enhancement Architecture</h3>

<p>The JavaScript implementation prioritizes performance and accessibility:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Feature detection for progressive enhancement</span>
<span class="kd">var</span> <span class="nx">features</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">jquery</span><span class="p">:</span> <span class="k">typeof</span> <span class="nx">jQuery</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">undefined</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">cssGrid</span><span class="p">:</span> <span class="nx">CSS</span><span class="p">.</span><span class="nf">supports</span><span class="p">(</span><span class="dl">'</span><span class="s1">display</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">grid</span><span class="dl">'</span><span class="p">),</span>
  <span class="na">stickyPosition</span><span class="p">:</span> <span class="nx">CSS</span><span class="p">.</span><span class="nf">supports</span><span class="p">(</span><span class="dl">'</span><span class="s1">position</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">sticky</span><span class="dl">'</span><span class="p">),</span>
  <span class="na">intersectionObserver</span><span class="p">:</span> <span class="dl">'</span><span class="s1">IntersectionObserver</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">window</span><span class="p">,</span>
  <span class="na">smoothScroll</span><span class="p">:</span> <span class="dl">'</span><span class="s1">scrollBehavior</span><span class="dl">'</span> <span class="k">in</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">style</span>
<span class="p">};</span>

<span class="c1">// Intersection Observer for active section highlighting</span>
<span class="kd">var</span> <span class="nx">observerOptions</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">rootMargin</span><span class="p">:</span> <span class="dl">'</span><span class="s1">-20% 0px -35% 0px</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// Trigger when section is in middle of viewport</span>
  <span class="na">threshold</span><span class="p">:</span> <span class="mi">0</span>
<span class="p">};</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">tocObserver</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IntersectionObserver</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">entries</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Update active section highlighting based on visible headers</span>
<span class="p">},</span> <span class="nx">observerOptions</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="fallback-toc-generation">Fallback TOC Generation</h3>

<p>When the jQuery TOC plugin isnâ€™t available, the system falls back to vanilla JavaScript:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">generateFallbackTOC</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">headers</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">h2, h3, h4, h5, h6</span><span class="dl">'</span><span class="p">);</span>

  <span class="c1">// Hide TOC if fewer than 2 headers</span>
  <span class="k">if </span><span class="p">(</span><span class="nx">headers</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">hideTOCContainer</span><span class="p">();</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// Generate hierarchical TOC structure</span>
  <span class="kd">var</span> <span class="nx">tocList</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">currentLevel</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">levelStack</span> <span class="o">=</span> <span class="p">[</span><span class="nx">tocList</span><span class="p">];</span>

  <span class="nx">headers</span><span class="p">.</span><span class="nf">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Create TOC entry with proper nesting</span>
    <span class="kd">var</span> <span class="nx">level</span> <span class="o">=</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">header</span><span class="p">.</span><span class="nx">tagName</span><span class="p">.</span><span class="nf">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
    <span class="kd">var</span> <span class="nx">listItem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">);</span>

    <span class="c1">// Handle nested levels and indentation</span>
    <span class="c1">// ... implementation details</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="accessibility-implementation">Accessibility Implementation</h2>

<p>Accessibility was a core requirement throughout the implementation:</p>

<h3 id="semantic-html-structure">Semantic HTML Structure</h3>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"toc-container"</span> <span class="na">role=</span><span class="s">"complementary"</span> <span class="na">aria-labelledby=</span><span class="s">"toc-heading"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"toc-header"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;h4</span> <span class="na">id=</span><span class="s">"toc-heading"</span> <span class="na">class=</span><span class="s">"toc-title"</span><span class="nt">&gt;</span>Table of Contents<span class="nt">&lt;/h4&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;nav</span> <span class="na">class=</span><span class="s">"toc-nav"</span> <span class="na">aria-label=</span><span class="s">"Table of Contents"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"toc"</span> <span class="na">role=</span><span class="s">"navigation"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/nav&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<h3 id="keyboard-navigation-support">Keyboard Navigation Support</h3>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.toc-nav</span> <span class="nn">#toc</span> <span class="nt">ul</span> <span class="nt">li</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="c1">// Focus indicators for accessibility</span>
  <span class="k">&amp;</span><span class="nd">:focus</span> <span class="p">{</span>
    <span class="nl">outline</span><span class="p">:</span> <span class="m">2px</span> <span class="nb">solid</span> <span class="mh">#0366d6</span><span class="p">;</span>
    <span class="nl">outline-offset</span><span class="p">:</span> <span class="m">2px</span><span class="p">;</span>
    <span class="nl">background-color</span><span class="p">:</span> <span class="mh">#f1f8ff</span><span class="p">;</span>
    <span class="nl">color</span><span class="p">:</span> <span class="mh">#0366d6</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="screen-reader-compatibility">Screen Reader Compatibility</h3>

<ul>
  <li>Proper ARIA labels and landmarks</li>
  <li>Semantic navigation structure</li>
  <li>Clear focus indicators</li>
  <li>Descriptive link text</li>
</ul>

<h2 id="performance-optimizations">Performance Optimizations</h2>

<p>Performance was critical for maintaining a smooth reading experience:</p>

<h3 id="debounced-scroll-handlers">Debounced Scroll Handlers</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Performance optimization: Throttled scroll handler for 60fps</span>
<span class="kd">var</span> <span class="nx">optimizedScrollHandler</span> <span class="o">=</span> <span class="nf">throttle</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Handle scroll events efficiently</span>
<span class="p">},</span> <span class="mi">16</span><span class="p">);</span> <span class="c1">// ~60fps</span>
</code></pre></div></div>

<h3 id="hardware-acceleration">Hardware Acceleration</h3>

<div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.toc-container</span> <span class="nc">.toc-nav</span> <span class="nn">#toc</span> <span class="nt">ul</span> <span class="nt">li</span> <span class="nt">a</span> <span class="p">{</span>
  <span class="c1">// Enable hardware acceleration for smooth transitions</span>
  <span class="nl">transform</span><span class="p">:</span> <span class="nf">translateZ</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
  <span class="nl">backface-visibility</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
  <span class="na">will-change</span><span class="p">:</span> <span class="n">background-color</span><span class="o">,</span> <span class="nb">color</span><span class="o">,</span> <span class="n">border-left-color</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="intersection-observer-benefits">Intersection Observer Benefits</h3>

<p>Using Intersection Observer instead of scroll events provided:</p>
<ul>
  <li><strong>Better Performance</strong>: No need to calculate element positions on every scroll</li>
  <li><strong>Battery Efficiency</strong>: Reduced CPU usage on mobile devices</li>
  <li><strong>Smoother Animation</strong>: Native browser optimization for intersection detection</li>
</ul>

<h2 id="responsive-design-strategy">Responsive Design Strategy</h2>

<p>The responsive approach prioritizes usability across all device sizes:</p>

<h3 id="desktop-experience-1024px">Desktop Experience (&gt;1024px)</h3>
<ul>
  <li>Full TOC visible in left sidebar</li>
  <li>Sticky positioning active</li>
  <li>Active section highlighting</li>
  <li>Smooth scrolling navigation</li>
</ul>

<h3 id="tablet-experience-768px-1024px">Tablet Experience (768px-1024px)</h3>
<ul>
  <li>TOC hidden to preserve reading space</li>
  <li>Single-column layout</li>
  <li>Full content width utilization</li>
</ul>

<h3 id="mobile-experience-768px">Mobile Experience (&lt;768px)</h3>
<ul>
  <li>TOC completely hidden</li>
  <li>Optimized typography and spacing</li>
  <li>Touch-friendly navigation</li>
</ul>

<h2 id="cross-browser-compatibility">Cross-Browser Compatibility</h2>

<p>The implementation includes comprehensive browser support:</p>

<h3 id="modern-browsers-chrome-60-firefox-60-safari-12">Modern Browsers (Chrome 60+, Firefox 60+, Safari 12+)</h3>
<ul>
  <li>Full functionality with all enhancements</li>
  <li>CSS Grid layout</li>
  <li>Intersection Observer API</li>
  <li>Sticky positioning</li>
</ul>

<h3 id="older-browsers-ie-11-older-safari">Older Browsers (IE 11, older Safari)</h3>
<ul>
  <li>Graceful degradation with float-based layout</li>
  <li>Fallback scroll-based highlighting</li>
  <li>Static positioning with visual indicators</li>
</ul>

<h3 id="feature-detection-and-polyfills">Feature Detection and Polyfills</h3>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Cross-browser compatibility: Array.from polyfill for IE11</span>
<span class="k">if </span><span class="p">(</span><span class="o">!</span><span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">Array</span><span class="p">.</span><span class="k">from</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arrayLike</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for </span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arrayLike</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">arrayLike</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
  <span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="testing-and-validation">Testing and Validation</h2>

<p>Comprehensive testing ensured the feature met all requirements:</p>

<h3 id="automated-validation">Automated Validation</h3>

<p>The implementation includes built-in requirement validation:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nf">validateTOCImplementation</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">validationResults</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">requirement1_1</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// TOC displays in right sidebar</span>
    <span class="na">requirement1_2</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// TOC remains sticky during scroll</span>
    <span class="na">requirement1_3</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// TOC hidden on mobile/tablet</span>
    <span class="na">requirement1_4</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// TOC hidden when fewer than 2 headers</span>
    <span class="c1">// ... additional requirements</span>
  <span class="p">};</span>

  <span class="c1">// Validate each requirement programmatically</span>
  <span class="c1">// Log results for debugging and monitoring</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="manual-testing-scenarios">Manual Testing Scenarios</h3>

<ul>
  <li><strong>Content Variations</strong>: Tested with posts having different header structures</li>
  <li><strong>Device Testing</strong>: Verified responsive behavior across multiple screen sizes</li>
  <li><strong>Accessibility Testing</strong>: Validated keyboard navigation and screen reader compatibility</li>
  <li><strong>Performance Testing</strong>: Monitored scroll performance and memory usage</li>
</ul>

<h3 id="cross-browser-testing">Cross-Browser Testing</h3>

<p>Tested across:</p>
<ul>
  <li>Chrome (latest and previous versions)</li>
  <li>Firefox (latest and ESR)</li>
  <li>Safari (macOS and iOS)</li>
  <li>Edge (Chromium-based)</li>
  <li>Internet Explorer 11 (graceful degradation)</li>
</ul>

<h2 id="results-and-impact">Results and Impact</h2>

<p>The implementation successfully transformed the blog reading experience:</p>

<h3 id="user-experience-improvements">User Experience Improvements</h3>

<p><strong>Navigation Efficiency</strong></p>
<ul>
  <li>Readers can now jump to any section instantly</li>
  <li>Clear visual hierarchy shows content structure</li>
  <li>Active highlighting shows current reading position</li>
</ul>

<p><strong>Responsive Design</strong></p>
<ul>
  <li>Optimal experience across all device sizes</li>
  <li>No horizontal scrolling or layout issues</li>
  <li>Appropriate content density for each screen size</li>
</ul>

<p><strong>Accessibility Enhancement</strong></p>
<ul>
  <li>Full keyboard navigation support</li>
  <li>Screen reader compatibility with proper ARIA labels</li>
  <li>High contrast mode support</li>
  <li>Reduced motion support for accessibility preferences</li>
</ul>

<h3 id="technical-achievements">Technical Achievements</h3>

<p><strong>Performance Metrics</strong></p>
<ul>
  <li>TOC generation: &lt;50ms for typical blog posts</li>
  <li>Scroll performance: Maintains 60fps during navigation</li>
  <li>Memory usage: &lt;1MB additional overhead</li>
  <li>First paint: No impact on initial page load</li>
</ul>

<p><strong>Browser Support</strong></p>
<ul>
  <li>100% functionality in modern browsers</li>
  <li>Graceful degradation in older browsers</li>
  <li>Zero JavaScript errors across all tested browsers</li>
</ul>

<p><strong>Code Quality</strong></p>
<ul>
  <li>Comprehensive error handling and fallbacks</li>
  <li>Extensive documentation and comments</li>
  <li>Modular, maintainable code structure</li>
</ul>

<h2 id="lessons-learned">Lessons Learned</h2>

<h3 id="spec-driven-development-benefits">Spec-Driven Development Benefits</h3>

<ol>
  <li><strong>Comprehensive Planning</strong>: Requirements phase identified edge cases that would have been missed in ad-hoc development</li>
  <li><strong>Risk Mitigation</strong>: Design phase revealed potential browser compatibility issues before implementation</li>
  <li><strong>Quality Assurance</strong>: Built-in validation ensured all requirements were met</li>
  <li><strong>Maintainable Code</strong>: Systematic approach resulted in well-documented, modular implementation</li>
</ol>

<h3 id="technical-insights">Technical Insights</h3>

<ol>
  <li><strong>Progressive Enhancement Works</strong>: Building with fallbacks at every level ensures broad compatibility</li>
  <li><strong>Performance Matters</strong>: Intersection Observer API provides significantly better performance than scroll events</li>
  <li><strong>Accessibility First</strong>: Considering accessibility from the start is easier than retrofitting</li>
  <li><strong>Responsive Strategy</strong>: Sometimes hiding features on mobile is better than trying to fit everything</li>
</ol>

<h3 id="implementation-challenges">Implementation Challenges</h3>

<ol>
  <li><strong>Cross-Browser Compatibility</strong>: CSS Grid and sticky positioning required extensive fallbacks</li>
  <li><strong>Performance Optimization</strong>: Balancing smooth animations with 60fps scroll performance</li>
  <li><strong>Accessibility Requirements</strong>: Ensuring full keyboard navigation while maintaining visual design</li>
  <li><strong>Content Variability</strong>: Handling posts with different header structures and edge cases</li>
</ol>

<h2 id="future-enhancements">Future Enhancements</h2>

<p>The spec-driven approach established a foundation for future improvements:</p>

<h3 id="planned-features">Planned Features</h3>
<ul>
  <li><strong>Collapsible Sections</strong>: Allow readers to collapse/expand TOC sections</li>
  <li><strong>Reading Progress</strong>: Visual indicator showing reading progress through the post</li>
  <li><strong>Bookmark Integration</strong>: Save reading position and favorite sections</li>
  <li><strong>Print Optimization</strong>: Enhanced print styles for TOC inclusion</li>
</ul>

<h3 id="technical-improvements">Technical Improvements</h3>
<ul>
  <li><strong>Service Worker Caching</strong>: Cache TOC generation for faster subsequent loads</li>
  <li><strong>WebP Image Support</strong>: Optimize any TOC-related images for better performance</li>
  <li><strong>Advanced Analytics</strong>: Track TOC usage patterns to optimize placement and features</li>
</ul>

<h2 id="implementation-guide">Implementation Guide</h2>

<p>For developers wanting to implement similar functionality:</p>

<h3 id="key-dependencies">Key Dependencies</h3>
<ul>
  <li><strong>CSS Grid</strong>: For modern layout with float fallbacks</li>
  <li><strong>Intersection Observer API</strong>: For performance-optimized active highlighting</li>
  <li><strong>jQuery (optional)</strong>: Can use existing TOC plugins or vanilla JavaScript fallback</li>
</ul>

<h3 id="critical-considerations">Critical Considerations</h3>
<ol>
  <li><strong>Content Threshold</strong>: Only show TOC when thereâ€™s enough content to justify it</li>
  <li><strong>Responsive Strategy</strong>: Consider hiding TOC on smaller screens rather than cramming it in</li>
  <li><strong>Performance</strong>: Use Intersection Observer instead of scroll events for better performance</li>
  <li><strong>Accessibility</strong>: Include proper ARIA labels and keyboard navigation from the start</li>
  <li><strong>Fallbacks</strong>: Plan for graceful degradation in older browsers</li>
</ol>

<h3 id="code-structure">Code Structure</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>â”œâ”€â”€ _includes/toc.html          # TOC HTML template and JavaScript
â”œâ”€â”€ _sass/minima/custom-styles.scss  # TOC styling and responsive behavior
â””â”€â”€ _layouts/post.html          # Post layout integration
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>The sticky TOC implementation demonstrates the power of spec-driven development for creating comprehensive, accessible, and performant web features. By taking time to properly define requirements, create a detailed design, and plan implementation tasks, the project delivered a feature that enhances the reading experience while maintaining broad browser compatibility and accessibility standards.</p>

<p>The systematic approach prevented common pitfalls like:</p>
<ul>
  <li>Missing edge cases (posts with few headers)</li>
  <li>Performance issues (scroll event handlers)</li>
  <li>Accessibility gaps (missing ARIA labels)</li>
  <li>Browser compatibility problems (lack of fallbacks)</li>
</ul>

<p>Most importantly, the spec-driven methodology created comprehensive documentation that will make future maintenance and enhancements straightforward. The requirements, design decisions, and implementation details are all documented, providing a clear roadmap for ongoing development.</p>

<p>This project reinforces why Iâ€™m excited about spec-driven development: it transforms complex features from overwhelming challenges into manageable, systematic projects that deliver high-quality results.</p>

<p>The TOC feature is now live on all blog posts, providing readers with the navigation assistance they need to efficiently consume long-form technical content. The next phase will focus on gathering user feedback and implementing the planned enhancements to further improve the reading experience.</p>

<hr />

<p><em>The complete specification documentation for this TOC implementation, including requirements, design documents, task breakdowns, and validation procedures, is available in the <a href="https://github.com/mani2106/Blog-Posts">blog repository</a> under <code class="language-plaintext highlighter-rouge">.kiro/specs/sticky-toc-component/</code>.</em></p>]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><category term="web-development" /><category term="jekyll" /><category term="ux" /><category term="accessibility" /><category term="spec-driven-development" /><category term="css" /><category term="javascript" /><summary type="html"><![CDATA[A comprehensive guide to implementing a responsive, accessible sticky TOC component using spec-driven development methodology]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://mani2106.github.io/Blog-Posts/images/images/a%20small%20blog%20title%20i.png" /><media:content medium="image" url="https://mani2106.github.io/Blog-Posts/images/images/a%20small%20blog%20title%20i.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Back from Hiatus: Jekyll Blog Security Hardening with Spec-Driven Development</title><link href="https://mani2106.github.io/Blog-Posts/security/jekyll/ruby/devops/maintenance/kiro/spec-driven-development/2025/09/30/jekyll-blog-security-hardening-journey.html" rel="alternate" type="text/html" title="Back from Hiatus: Jekyll Blog Security Hardening with Spec-Driven Development" /><published>2025-09-30T00:00:00+00:00</published><updated>2025-09-30T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/security/jekyll/ruby/devops/maintenance/kiro/spec-driven-development/2025/09/30/jekyll-blog-security-hardening-journey</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/security/jekyll/ruby/devops/maintenance/kiro/spec-driven-development/2025/09/30/jekyll-blog-security-hardening-journey.html"><![CDATA[<h1 id="the-comeback-from-hiatus-to-security-hardening">The Comeback: From Hiatus to Security Hardening</h1>

<p>After a long hiatus from blogging, I decided it was time to dust off my Jekyll blog and get back to writing. But when I opened my repository, I was greeted by a concerning sight: <strong>12 GitHub Dependabot security alerts</strong> ranging from critical to low severity. These werenâ€™t just minor updatesâ€”some were critical vulnerabilities with CVSS scores of 9.1 that could lead to memory corruption and use-after-free attacks.</p>

<p>This seemed like the perfect opportunity to not only get my blog back online securely, but also to try out a new approach Iâ€™d been exploring: <strong>spec-driven development using Kiro</strong>. Rather than diving straight into code changes, I decided to treat this security hardening as a proper software project with requirements, design, and implementation planning.</p>

<h2 id="why-spec-driven-development">Why Spec-Driven Development?</h2>

<p>Coming back to a project after months away, I realized I needed more than just quick fixes. I needed:</p>
<ul>
  <li><strong>Clear documentation</strong> of what needed to be done and why</li>
  <li><strong>Systematic approach</strong> to prevent breaking changes</li>
  <li><strong>Maintainable procedures</strong> for future updates</li>
  <li><strong>Comprehensive testing strategy</strong> to ensure nothing broke</li>
</ul>

<p>This is where Kiroâ€™s spec-driven approach became invaluable.</p>

<h2 id="the-security-landscape">The Security Landscape</h2>

<p>The vulnerabilities spanned across multiple critical components:</p>

<ul>
  <li><strong>Nokogiri</strong> (XML/HTML parser): 5 alerts including critical memory corruption issues</li>
  <li><strong>REXML</strong> (XML parser): 6 alerts mostly related to Denial of Service attacks</li>
  <li><strong>ActiveSupport</strong> (Rails component): 1 alert for potential file disclosure</li>
</ul>

<p>Hereâ€™s what I was facing:</p>

<h3 id="critical-priority-">Critical Priority ğŸš¨</h3>
<ul>
  <li><strong>CVE-2025-49794, CVE-2025-49796</strong>: Use-after-free and memory corruption in Nokogiri (CVSS 9.1)</li>
</ul>

<h3 id="high-priority-ï¸">High Priority âš ï¸</h3>
<ul>
  <li><strong>CVE-2025-24855, CVE-2024-55549</strong>: Use-after-free in libxslt</li>
  <li><strong>CVE-2024-43398</strong>: REXML DoS vulnerability with deep XML elements</li>
</ul>

<h3 id="medium-priority-">Medium Priority ğŸ“‹</h3>
<ul>
  <li>Multiple REXML DoS vulnerabilities</li>
  <li>ActiveSupport file disclosure vulnerability</li>
</ul>

<h2 id="the-spec-driven-approach-with-kiro">The Spec-Driven Approach with Kiro</h2>

<p>Instead of randomly updating gems, I used Kiro to develop a structured methodology through proper specification:</p>

<h3 id="1-requirements-gathering">1. Requirements Gathering</h3>
<p>Using Kiro, I started by creating a comprehensive requirements document that captured:</p>
<ul>
  <li><strong>User stories</strong> for each type of security concern</li>
  <li><strong>Acceptance criteria</strong> in EARS format (Easy Approach to Requirements Syntax)</li>
  <li><strong>Priority matrix</strong> based on vulnerability severity</li>
  <li><strong>Success metrics</strong> for the security hardening</li>
</ul>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gs">**User Story:**</span> As a blog maintainer, I want to analyze the current GitHub
security alerts for my gem dependencies, so that I can prioritize which
vulnerabilities need immediate attention.

<span class="gu">#### Acceptance Criteria</span>
<span class="p">1.</span> WHEN analyzing GitHub alerts THEN the system SHALL categorize
   vulnerabilities by severity (critical, high, medium, low)
<span class="p">2.</span> WHEN vulnerabilities are categorized THEN the system SHALL identify
   which gems require updates
</code></pre></div></div>

<h3 id="2-design-document">2. Design Document</h3>
<p>Kiro helped me create a detailed design that outlined:</p>
<ul>
  <li><strong>Vulnerability analysis framework</strong> with three-phase approach</li>
  <li><strong>Gem upgrade mapping</strong> with version constraints</li>
  <li><strong>Dependency resolution strategy</strong> to prevent conflicts</li>
  <li><strong>Error handling scenarios</strong> and rollback procedures</li>
</ul>

<h3 id="3-implementation-planning">3. Implementation Planning</h3>
<p>The spec process generated a detailed task breakdown:</p>
<ul>
  <li>8 major phases with 15 sub-tasks</li>
  <li>Each task linked to specific requirements</li>
  <li>Clear validation steps for each phase</li>
  <li>Rollback procedures documented upfront</li>
</ul>

<h3 id="4-baseline-documentation">4. Baseline Documentation</h3>
<p>Through the spec process, I systematically documented the current state:</p>
<ul>
  <li>Ruby 2.7.1 (approaching EOL)</li>
  <li>Jekyll 4.1.1 (outdated)</li>
  <li>Bundler 2.1.4 (incompatible with modern Ruby)</li>
  <li>Multiple outdated gems with restrictive version constraints</li>
</ul>

<h3 id="5-priority-based-upgrade-strategy">5. Priority-Based Upgrade Strategy</h3>
<p>The design phase helped me categorize updates by security impact and dependency relationships:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Phase 1: Ruby runtime upgrade</span>
<span class="no">Ruby</span> <span class="mf">2.7</span><span class="o">.</span><span class="mi">1</span> <span class="err">â†’</span> <span class="no">Ruby</span> <span class="mf">3.3</span><span class="o">.</span><span class="mi">9</span>

<span class="c1"># Phase 2: Critical security gems</span>
<span class="ss">nokogiri: </span><span class="s2">"&lt; 1.18.9"</span> <span class="err">â†’</span> <span class="s2">"~&gt; 1.18.0"</span>
<span class="ss">rexml: </span><span class="s2">"&lt; 3.3.9"</span> <span class="err">â†’</span> <span class="s2">"~&gt; 3.4.0"</span>

<span class="c1"># Phase 3: Major framework updates</span>
<span class="ss">activesupport: </span><span class="s2">"&lt; 6.1.7.5"</span> <span class="err">â†’</span> <span class="s2">"~&gt; 7.2.0"</span>

<span class="c1"># Phase 4: Supporting infrastructure</span>
<span class="ss">faraday: </span><span class="s2">"&lt; 1.0"</span> <span class="err">â†’</span> <span class="s2">"~&gt; 2.12.0"</span>
</code></pre></div></div>

<h3 id="3-constraint-optimization">3. Constraint Optimization</h3>
<p>One major issue was overly restrictive version constraints that prevented security updates:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Before: Blocking security updates</span>
<span class="n">gem</span> <span class="s2">"faraday"</span><span class="p">,</span> <span class="s2">"&lt; 1.0"</span>  <span class="c1"># Stuck on 0.17.5 from 2019!</span>

<span class="c1"># After: Security-friendly constraints</span>
<span class="n">gem</span> <span class="s2">"faraday"</span><span class="p">,</span> <span class="s2">"~&gt; 2.12"</span>  <span class="c1"># Allows patch updates</span>
</code></pre></div></div>

<h2 id="the-implementation-journey-spec-to-code">The Implementation Journey: Spec to Code</h2>

<p>With Kiroâ€™s comprehensive spec in hand, the implementation became straightforward. Each task was clearly defined with acceptance criteria, making it easy to know exactly what needed to be done and how to validate success.</p>

<h3 id="task-by-task-execution">Task-by-Task Execution</h3>
<p>The beauty of the spec-driven approach was that I could work through each task systematically:</p>

<div class="language-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">-</span> [x] 1. Establish baseline and prepare for upgrades
<span class="p">-</span> [x] 2. Upgrade Ruby version to latest stable
<span class="p">-</span> [x] 3. Update critical security gems (Nokogiri and REXML)
<span class="p">-</span> [x] 4. Update ActiveSupport to latest Rails 7.x series
<span class="p">-</span> [x] 5. Update supporting gems to latest versions
<span class="p">-</span> [x] 6. Optimize Gemfile version constraints for security
<span class="p">-</span> [x] 7. Comprehensive testing and validation
<span class="p">-</span> [x] 8. Document changes and create maintenance procedures
</code></pre></div></div>

<h3 id="ruby-version-upgrade">Ruby Version Upgrade</h3>
<p>Following the specâ€™s Phase 1, the foundation needed to be solid. Ruby 2.7.1 was approaching end-of-life and causing bundler compatibility issues:</p>

<div class="language-dockerfile highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Before</span>
<span class="k">FROM</span><span class="s"> jekyll/jekyll:4.1.0  # Ruby 2.7.1</span>

<span class="c"># After</span>
<span class="k">FROM</span><span class="s"> ruby:3.3-alpine     # Ruby 3.3.9</span>
</code></pre></div></div>

<p>This single change resolved multiple compatibility issues and enabled modern gem versions.</p>

<h3 id="critical-security-updates">Critical Security Updates</h3>

<p><strong>Nokogiri: The Big One</strong>
Nokogiri had the most severe vulnerabilities, including critical memory corruption issues:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Updated from 1.16.3 to 1.18.10</span>
<span class="n">gem</span> <span class="s2">"nokogiri"</span><span class="p">,</span> <span class="s2">"~&gt; 1.18"</span>
</code></pre></div></div>

<p>This update resolved 5 security alerts, including the critical CVE-2025-49794 and CVE-2025-49796.</p>

<p><strong>REXML: DoS Protection</strong>
REXML had 6 different Denial of Service vulnerabilities:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Updated from 3.2.5 to 3.4.4</span>
<span class="n">gem</span> <span class="s2">"rexml"</span><span class="p">,</span> <span class="s2">"~&gt; 3.4"</span>
</code></pre></div></div>

<p><strong>ActiveSupport: Major Version Jump</strong>
The most challenging update was ActiveSupport, requiring a major version upgrade:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 6.0.6.1 â†’ 7.2.2.2 (major version jump)</span>
<span class="n">gem</span> <span class="s2">"activesupport"</span><span class="p">,</span> <span class="s2">"~&gt; 7.2"</span>
</code></pre></div></div>

<p>Surprisingly, this major version upgrade had zero breaking changes for Jekyll usageâ€”a testament to Railsâ€™ commitment to backward compatibility.</p>

<h2 id="testing-and-validation">Testing and Validation</h2>

<p>Each phase included comprehensive testing:</p>

<h3 id="automated-checks">Automated Checks</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Build verification</span>
bundle <span class="nb">install
</span>jekyll build

<span class="c"># Functionality testing</span>
docker-compose up <span class="nt">-d</span>
curl <span class="nt">-I</span> http://localhost:4000
</code></pre></div></div>

<h3 id="manual-verification">Manual Verification</h3>
<ul>
  <li>âœ… All blog posts render correctly</li>
  <li>âœ… Math equations display properly (KaTeX)</li>
  <li>âœ… Code syntax highlighting works</li>
  <li>âœ… RSS feed generates correctly</li>
  <li>âœ… SEO tags are present</li>
  <li>âœ… Site navigation functions</li>
</ul>

<h2 id="the-results">The Results</h2>

<h3 id="security-impact">Security Impact</h3>
<ul>
  <li><strong>12 vulnerabilities resolved</strong>: From critical to low severity</li>
  <li><strong>Zero known vulnerabilities</strong>: Clean security audit</li>
  <li><strong>Future-proof constraints</strong>: Automatic security patches enabled</li>
</ul>

<h3 id="performance-improvements">Performance Improvements</h3>
<ul>
  <li><strong>Ruby 3.3.x</strong>: Significant performance gains over 2.7.x</li>
  <li><strong>Modern HTTP/2</strong>: Faraday 2.x includes modern features</li>
  <li><strong>Updated plugins</strong>: Performance optimizations included</li>
</ul>

<h3 id="version-summary">Version Summary</h3>
<p>| Component | Before | After | Security Impact |
|â€”â€”â€”â€“|â€”â€”â€“|â€”â€”-|â€”â€”â€”â€”â€”â€“|
| Ruby | 2.7.1 | 3.3.9 | Latest security patches |
| Nokogiri | 1.16.3 | 1.18.10 | 5 CVEs resolved |
| REXML | 3.2.5 | 3.4.4 | 6 DoS vulnerabilities fixed |
| ActiveSupport | 6.0.6.1 | 7.2.2.2 | File disclosure vulnerability fixed |
| Faraday | 0.17.5 | 2.12.3 | 5+ years of security updates |</p>

<h2 id="the-power-of-spec-driven-development">The Power of Spec-Driven Development</h2>

<p>This project reinforced why Iâ€™m excited about spec-driven development with Kiro:</p>

<h3 id="benefits-i-experienced">Benefits I Experienced</h3>
<ol>
  <li><strong>Clear roadmap</strong>: Never wondered â€œwhat should I do next?â€</li>
  <li><strong>Risk mitigation</strong>: Potential issues identified upfront in design phase</li>
  <li><strong>Comprehensive testing</strong>: Validation criteria defined before implementation</li>
  <li><strong>Documentation by design</strong>: Requirements and procedures created as part of the process</li>
  <li><strong>Maintainable outcomes</strong>: Future changes have a clear framework to follow</li>
</ol>

<h3 id="the-kiro-advantage">The Kiro Advantage</h3>
<ul>
  <li><strong>Iterative refinement</strong>: Requirements â†’ Design â†’ Tasks â†’ Implementation</li>
  <li><strong>Built-in validation</strong>: Each phase reviewed before proceeding</li>
  <li><strong>Comprehensive coverage</strong>: Nothing falls through the cracks</li>
  <li><strong>Future-ready</strong>: Maintenance procedures established from day one</li>
</ul>

<h2 id="lessons-learned">Lessons Learned</h2>

<h3 id="1-spec-driven-beats-ad-hoc">1. Spec-Driven Beats Ad-Hoc</h3>
<p>Taking time to create proper requirements and design prevented dependency conflicts and reduced risk significantly.</p>

<h3 id="2-version-constraints-matter">2. Version Constraints Matter</h3>
<p>Overly restrictive constraints (<code class="language-plaintext highlighter-rouge">gem "name", "&lt; 1.0"</code>) can block critical security updates for years.</p>

<h3 id="3-major-version-upgrades-arent-always-breaking">3. Major Version Upgrades Arenâ€™t Always Breaking</h3>
<p>ActiveSupport 6.x â†’ 7.x had zero breaking changes for our Jekyll usage.</p>

<h3 id="4-documentation-is-critical">4. Documentation Is Critical</h3>
<p>The spec process automatically generated detailed records of changes, rationale, and rollback procedures.</p>

<h3 id="5-kiro-makes-complex-projects-manageable">5. Kiro Makes Complex Projects Manageable</h3>
<p>What could have been an overwhelming security crisis became a systematic, well-documented project.</p>

<h2 id="whats-next-for-this-blog">Whatâ€™s Next for This Blog</h2>

<p>Now that the security foundation is solid, Iâ€™m excited about the future improvements planned:</p>

<h3 id="upcoming-ux-enhancements">Upcoming UX Enhancements</h3>
<ul>
  <li><strong>GitHub Discussions integration</strong>: Moving away from Utterances to GitHubâ€™s native discussion feature for better community engagement and moderation</li>
  <li><strong>Redesigned reading experience</strong>: Complete UX overhaul focusing on readability, accessibility, and modern design principles</li>
  <li><strong>Enhanced layout architecture</strong>:
    <ul>
      <li><strong>Left sidebar</strong>: Table of Contents for easy navigation within posts</li>
      <li><strong>Right sidebar</strong>: Comments section for contextual discussions</li>
      <li><strong>Responsive design</strong>: Seamless experience across desktop, tablet, and mobile</li>
      <li><strong>Progressive enhancement</strong>: Modern features that degrade gracefully</li>
    </ul>
  </li>
</ul>

<h3 id="technical-roadmap">Technical Roadmap</h3>
<ul>
  <li><strong>Performance optimization</strong>: Leveraging Ruby 3.3.x performance gains and modern Jekyll features</li>
  <li><strong>Enhanced SEO</strong>: Building on Jekyll-seo-tag 2.8.0 improvements with structured data</li>
  <li><strong>Better accessibility</strong>: WCAG 2.1 compliance and screen reader optimization</li>
  <li><strong>Modern web standards</strong>: HTTP/3, WebP images, and progressive loading</li>
</ul>

<h3 id="content-strategy-evolution">Content Strategy Evolution</h3>
<ul>
  <li><strong>More technical deep-dives</strong>: Like this security hardening journey</li>
  <li><strong>Spec-driven development series</strong>: Sharing the Kiro methodology and real-world applications</li>
  <li><strong>Open source contributions</strong>: Documenting contributions and community learnings</li>
  <li><strong>Interactive tutorials</strong>: Hands-on guides with embedded examples</li>
</ul>

<h2 id="ongoing-maintenance-strategy">Ongoing Maintenance Strategy</h2>

<p>The spec process established comprehensive ongoing procedures:</p>

<h3 id="monthly-security-reviews">Monthly Security Reviews</h3>
<ul>
  <li>Monitor GitHub Dependabot alerts</li>
  <li>Apply critical security patches following established procedures</li>
  <li>Update security documentation</li>
</ul>

<h3 id="quarterly-dependency-updates">Quarterly Dependency Updates</h3>
<ul>
  <li>Update all gems to latest stable versions</li>
  <li>Execute comprehensive testing protocols</li>
  <li>Review and optimize version constraints</li>
</ul>

<h3 id="annual-major-updates">Annual Major Updates</h3>
<ul>
  <li>Evaluate Ruby version upgrades</li>
  <li>Consider Jekyll major version updates</li>
  <li>Comprehensive security audit and spec review</li>
</ul>

<h2 id="the-maintenance-procedures">The Maintenance Procedures</h2>

<p>Kiro helped create comprehensive <a href="https://github.com/mani2106/Blog-Posts/blob/master/MAINTENANCE_PROCEDURES.md">maintenance procedures</a> covering:</p>

<ul>
  <li><strong>Emergency Response</strong>: Critical vulnerability response within 24 hours</li>
  <li><strong>Regular Updates</strong>: Monthly and quarterly update schedules</li>
  <li><strong>Testing Protocols</strong>: Comprehensive validation checklists</li>
  <li><strong>Rollback Procedures</strong>: Quick recovery from failed updates</li>
  <li><strong>Documentation Standards</strong>: Keeping procedures current</li>
</ul>

<h2 id="key-takeaways">Key Takeaways</h2>

<h3 id="for-jekyll-users">For Jekyll Users</h3>
<ol>
  <li><strong>Donâ€™t ignore Dependabot alerts</strong>: They represent real security risks</li>
  <li><strong>Use semantic versioning wisely</strong>: <code class="language-plaintext highlighter-rouge">~&gt; x.y</code> allows security patches</li>
  <li><strong>Keep Ruby current</strong>: EOL versions create cascading problems</li>
  <li><strong>Test systematically</strong>: Automated + manual validation prevents issues</li>
  <li><strong>Document everything</strong>: Future you will thank present you</li>
</ol>

<h3 id="for-developers">For Developers</h3>
<ol>
  <li><strong>Spec-driven development works</strong>: Taking time to plan saves time in execution</li>
  <li><strong>Requirements matter</strong>: Clear acceptance criteria prevent scope creep and missed edge cases</li>
  <li><strong>Design upfront</strong>: Identifying issues before coding saves debugging time</li>
  <li><strong>Maintenance is part of the spec</strong>: Donâ€™t just build it, plan to maintain it</li>
  <li><strong>Tools like Kiro are game-changers</strong>: Structured approaches scale better than ad-hoc methods</li>
</ol>

<h2 id="the-bottom-line">The Bottom Line</h2>

<p>What started as a comeback blog post became a demonstration of modern development practices. The combination of returning from hiatus with 12 security alerts created the perfect opportunity to try spec-driven development with Kiro.</p>

<p>The systematic approach took more time upfront but resulted in:</p>
<ul>
  <li><strong>Zero security vulnerabilities</strong></li>
  <li><strong>Improved performance and modern dependencies</strong></li>
  <li><strong>Comprehensive documentation and procedures</strong></li>
  <li><strong>Clear roadmap for future improvements</strong></li>
  <li><strong>Confidence in ongoing maintenance</strong></li>
</ul>

<p>The blog is now running on Ruby 3.3.9 with the latest secure versions of all dependencies. More importantly, I have a proven methodology for future updatesâ€”both security and feature enhancements.</p>

<p>This is just the beginning of my return to regular blogging. With a solid, secure foundation and a clear development methodology, Iâ€™m excited to continue improving this blog and sharing more technical insights.</p>

<p>The next posts will dive deeper into spec-driven development, the upcoming UX redesign process, and how GitHub Discussions will transform the commenting experience.</p>

<p>I will try to do regular blogging after a multi-year dormancy! ğŸš€</p>

<hr />
<!--
*The complete specification documentation for this security hardening project, including requirements, design documents, task breakdowns, and maintenance procedures, is available in the [blog repository](https://github.com/mani2106/Blog-Posts) under `.kiro/specs/gemfile-security-hardening/`.* -->]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><category term="security" /><category term="jekyll" /><category term="ruby" /><category term="devops" /><category term="maintenance" /><category term="kiro" /><category term="spec-driven-development" /><summary type="html"><![CDATA[How I returned to blogging by systematically resolving 12 security vulnerabilities using Kiro's spec-driven approach, and what's coming next]]></summary><media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://mani2106.github.io/Blog-Posts/images/images/small_ruby_secure.png" /><media:content medium="image" url="https://mani2106.github.io/Blog-Posts/images/images/small_ruby_secure.png" xmlns:media="http://search.yahoo.com/mrss/" /></entry><entry><title type="html">Explaining prediction models and individual predictions</title><link href="https://mani2106.github.io/Blog-Posts/take-home/implementation/2021/05/29/model-agnostic-featimp.html" rel="alternate" type="text/html" title="Explaining prediction models and individual predictions" /><published>2021-05-29T00:00:00+00:00</published><updated>2021-05-29T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/take-home/implementation/2021/05/29/model%20agnostic%20featimp</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/take-home/implementation/2021/05/29/model-agnostic-featimp.html"><![CDATA[<p>The following script tries to reproduce one algorithm from the paper titled <code class="language-plaintext highlighter-rouge">Explaining prediction models and individual predictions</code></p>

<p>You can have a look at the resultant json <a href="https://github.com/mani2106/Poshmark-assignment">here</a></p>

<p>The json would have record level information of each feature and its impact on the prediction.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">from</span> <span class="n">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span> <span class="n">json</span><span class="p">,</span> <span class="n">joblib</span>

<span class="c1"># The feature importances for each data instance 
# are calculated with four random samples drawn from the data
# I also tried to use numba to compile to machine code but could
# not achieve it
</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="sh">'</span><span class="s">.</span><span class="sh">'</span>

<span class="c1"># LOAD your model
</span><span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">model_pipeline.joblib</span><span class="sh">'</span><span class="p">))</span>

<span class="c1"># Bring in the data training and testing data
</span><span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">train.csv</span><span class="sh">'</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="sh">'</span><span class="s">test.csv</span><span class="sh">'</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># TODO try to complete numba usage
# @numba.jit(nopython=True)
</span><span class="k">def</span> <span class="nf">shuffle_feature_records</span><span class="p">(</span>
    <span class="n">full_data</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">,</span>
    <span class="n">feature_data</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">,</span>
    <span class="n">feature_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">m</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">np</span><span class="p">.</span><span class="n">array</span><span class="p">]:</span>
    <span class="sh">"""</span><span class="s">
    Randomly selects `m` no of records to compare and calculate feature importances
    </span><span class="sh">"""</span>
    <span class="n">feat_len</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">feature_data</span><span class="p">)</span>
    <span class="n">feature_indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">feat_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="c1"># take random indices
</span>    <span class="n">rand_indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">choice</span><span class="p">(</span><span class="n">full_data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

    <span class="c1"># take random samples
</span>    <span class="n">w</span> <span class="o">=</span> <span class="n">full_data</span><span class="p">[</span><span class="n">rand_indices</span><span class="p">]</span>

    <span class="n">b1_vec</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">empty</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">feat_len</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">object</span><span class="p">)</span>
    <span class="n">b2_vec</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">empty</span><span class="p">((</span><span class="n">m</span><span class="p">,</span> <span class="n">feat_len</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="p">.</span><span class="nb">object</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>

        <span class="n">del_index</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argwhere</span><span class="p">(</span><span class="n">feature_indices</span><span class="o">==</span><span class="n">feature_index</span><span class="p">)</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="n">feature_indices</span><span class="p">,</span> <span class="n">del_index</span><span class="p">)</span>
        <span class="c1"># remove current feature index to add later
</span>        <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">shuffle</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>

        <span class="n">split_pt</span> <span class="o">=</span> <span class="n">indices</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>

        <span class="c1"># split indices for 2 different vectors
</span>        <span class="n">ind_x</span><span class="p">,</span> <span class="n">ind_w</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:</span><span class="n">split_pt</span><span class="p">],</span> <span class="n">indices</span><span class="p">[</span><span class="n">split_pt</span><span class="p">:]</span>

        <span class="c1"># form the indices for b1 and b2 vectors
</span>        <span class="n">ind_x_1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ind_x</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">)</span>
        <span class="n">ind_w_1</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ind_w</span><span class="p">,</span> <span class="n">feature_index</span><span class="p">)</span>

        <span class="c1"># to ensure the features are assigned in the order of training data
</span>        <span class="n">b1_sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argsort</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ind_x</span><span class="p">,</span> <span class="n">ind_w_1</span><span class="p">))</span>
        <span class="n">b2_sort_indices</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">argsort</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">ind_x_1</span><span class="p">,</span> <span class="n">ind_w</span><span class="p">))</span>

        <span class="n">b1_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">((</span><span class="n">feature_data</span><span class="p">[</span><span class="n">ind_x</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ind_w_1</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">b1_sort_indices</span><span class="p">]</span>
        <span class="n">b2_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">((</span><span class="n">feature_data</span><span class="p">[</span><span class="n">ind_x_1</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">ind_w</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="n">b2_sort_indices</span><span class="p">]</span>

    <span class="n">arrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">b1_vec</span><span class="p">,</span> <span class="n">b2_vec</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">arrs</span>

<span class="k">def</span> <span class="nf">get_feat_imp_data</span><span class="p">(</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Pipeline</span><span class="p">,</span>
    <span class="n">X_train</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">X_test</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="sh">"""</span><span class="s">
    Loops over the available data and sends them for calculation
    </span><span class="sh">"""</span>
    <span class="c1"># Get features for 100 records
</span>    <span class="n">tr_data</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">X_train</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">].</span><span class="nf">isin</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">))].</span><span class="nf">copy</span><span class="p">()</span>
    <span class="n">te_data</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">X_test</span><span class="p">[</span><span class="sh">'</span><span class="s">id</span><span class="sh">'</span><span class="p">].</span><span class="nf">isin</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">101</span><span class="p">))].</span><span class="nf">copy</span><span class="p">()</span>

    <span class="c1"># join all the data
</span>    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">([</span><span class="n">tr_data</span><span class="p">,</span> <span class="n">te_data</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="sh">'</span><span class="s">rows</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">cols</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">columns</span><span class="p">.</span><span class="nf">tolist</span><span class="p">()</span>

    <span class="n">feat_imp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># send them one by one to calculate
</span>    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">.</span><span class="n">values</span><span class="p">:</span>
        <span class="n">col_imp</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">feat_index</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="nf">shuffle_feature_records</span><span class="p">(</span><span class="n">X_train</span><span class="p">.</span><span class="n">values</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">feature_index</span><span class="o">=</span><span class="n">feat_index</span><span class="p">,</span> <span class="n">m</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">b1</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
            <span class="n">b2</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">cols</span><span class="p">)</span>
            <span class="n">b1_pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">b1</span><span class="p">)</span>
            <span class="n">b2_pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>
            <span class="n">col_imp</span><span class="p">[</span><span class="n">cols</span><span class="p">[</span><span class="n">feat_index</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">b1_pred</span> <span class="o">-</span> <span class="n">b2_pred</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span>

        <span class="n">feat_imp</span><span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">col_imp</span>

    <span class="k">return</span> <span class="n">feat_imp</span>


<span class="n">feats</span> <span class="o">=</span> <span class="nf">get_feat_imp_data</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>

<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">feat_imps_1.json</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">feats</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</code></pre></div></div>]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><category term="take-home" /><category term="Implementation" /><summary type="html"><![CDATA[The following script tries to reproduce one algorithm from the paper titled Explaining prediction models and individual predictions]]></summary></entry><entry><title type="html">Probability</title><link href="https://mani2106.github.io/Blog-Posts/2021/05/23/probability.html" rel="alternate" type="text/html" title="Probability" /><published>2021-05-23T00:00:00+00:00</published><updated>2021-05-23T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/2021/05/23/probability</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/2021/05/23/probability.html"><![CDATA[]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Autodiff</title><link href="https://mani2106.github.io/Blog-Posts/2021/05/16/autodiff.html" rel="alternate" type="text/html" title="Autodiff" /><published>2021-05-16T00:00:00+00:00</published><updated>2021-05-16T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/2021/05/16/autodiff</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/2021/05/16/autodiff.html"><![CDATA[]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Chemdner</title><link href="https://mani2106.github.io/Blog-Posts/2021/04/26/chemdNER.html" rel="alternate" type="text/html" title="Chemdner" /><published>2021-04-26T00:00:00+00:00</published><updated>2021-04-26T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/2021/04/26/chemdNER</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/2021/04/26/chemdNER.html"><![CDATA[]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Calculus_nb</title><link href="https://mani2106.github.io/Blog-Posts/2021/04/25/calculus_nb.html" rel="alternate" type="text/html" title="Calculus_nb" /><published>2021-04-25T00:00:00+00:00</published><updated>2021-04-25T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/2021/04/25/calculus_nb</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/2021/04/25/calculus_nb.html"><![CDATA[]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">Price_pred_notebook</title><link href="https://mani2106.github.io/Blog-Posts/2021/04/10/price_pred_notebook.html" rel="alternate" type="text/html" title="Price_pred_notebook" /><published>2021-04-10T00:00:00+00:00</published><updated>2021-04-10T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/2021/04/10/price_pred_notebook</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/2021/04/10/price_pred_notebook.html"><![CDATA[]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">D2lai Exercises Pt3</title><link href="https://mani2106.github.io/Blog-Posts/2021/02/09/d2lai-exercises-pt3.html" rel="alternate" type="text/html" title="D2lai Exercises Pt3" /><published>2021-02-09T00:00:00+00:00</published><updated>2021-02-09T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/2021/02/09/d2lai-exercises-pt3</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/2021/02/09/d2lai-exercises-pt3.html"><![CDATA[]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><summary type="html"><![CDATA[]]></summary></entry><entry><title type="html">D2lai_exercises_pt2</title><link href="https://mani2106.github.io/Blog-Posts/2021/02/07/d2lai_exercises_pt2.html" rel="alternate" type="text/html" title="D2lai_exercises_pt2" /><published>2021-02-07T00:00:00+00:00</published><updated>2021-02-07T00:00:00+00:00</updated><id>https://mani2106.github.io/Blog-Posts/2021/02/07/d2lai_exercises_pt2</id><content type="html" xml:base="https://mani2106.github.io/Blog-Posts/2021/02/07/d2lai_exercises_pt2.html"><![CDATA[]]></content><author><name>Manimaran Panneerselvam</name><email>manimaran_p@outlook.com</email></author><summary type="html"><![CDATA[]]></summary></entry></feed>