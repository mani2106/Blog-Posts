<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Mother’s day Sentiment analysis - with spaCy | Manimaran Panneerselvam’s blog</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Mother’s day Sentiment analysis - with spaCy" />
<meta name="author" content="Manimaran Panneerselvam" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="In this notebook I try to use a competition dataset of tweets reacting to Mother’s day and classify their sentiments with spaCy" />
<meta property="og:description" content="In this notebook I try to use a competition dataset of tweets reacting to Mother’s day and classify their sentiments with spaCy" />
<link rel="canonical" href="https://mani2106.github.io/Blog-Posts/nlp/eda/sentiment/2020/05/30/Deep_learning_approach_for_text_classification_with_spacy.html" />
<meta property="og:url" content="https://mani2106.github.io/Blog-Posts/nlp/eda/sentiment/2020/05/30/Deep_learning_approach_for_text_classification_with_spacy.html" />
<meta property="og:site_name" content="Manimaran Panneerselvam’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-05-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Mother’s day Sentiment analysis - with spaCy" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Manimaran Panneerselvam"},"dateModified":"2020-05-30T00:00:00+00:00","datePublished":"2020-05-30T00:00:00+00:00","description":"In this notebook I try to use a competition dataset of tweets reacting to Mother’s day and classify their sentiments with spaCy","headline":"Mother’s day Sentiment analysis - with spaCy","mainEntityOfPage":{"@type":"WebPage","@id":"https://mani2106.github.io/Blog-Posts/nlp/eda/sentiment/2020/05/30/Deep_learning_approach_for_text_classification_with_spacy.html"},"url":"https://mani2106.github.io/Blog-Posts/nlp/eda/sentiment/2020/05/30/Deep_learning_approach_for_text_classification_with_spacy.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/Blog-Posts/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://mani2106.github.io/Blog-Posts/feed.xml" title="Manimaran Panneerselvam&apos;s blog" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-168240544-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-168240544-1');
</script>




<script>
(function() {
  const theme = localStorage.getItem('theme-preference') || 'auto';
  if (theme === 'dark' || (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    document.documentElement.setAttribute('data-theme', 'dark');
  } else {
    document.documentElement.setAttribute('data-theme', 'light');
  }
})();
</script><link rel="shortcut icon" type="image/x-icon" href="/Blog-Posts/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>

<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>

<script src="/Blog-Posts/assets/js/theme-toggle.js"></script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/Blog-Posts/">Manimaran Panneerselvam&#39;s blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/Blog-Posts/about/">About Me</a><a class="page-link" href="/Blog-Posts/search/">Search</a><a class="page-link" href="/Blog-Posts/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Mother&#39;s day Sentiment analysis - with spaCy</h1><p class="page-description">In this notebook I try to use a competition dataset of tweets reacting to Mother's day and classify their sentiments with spaCy</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-05-30T00:00:00+00:00" itemprop="datePublished">
        May 30, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      27 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i>
      
        <a class="category-tags-link" href="/Blog-Posts/categories/#nlp">nlp</a>
        &nbsp;
      
        <a class="category-tags-link" href="/Blog-Posts/categories/#eda">eda</a>
        &nbsp;
      
        <a class="category-tags-link" href="/Blog-Posts/categories/#sentiment">sentiment</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/mani2106/Blog-Posts/tree/master/_notebooks/2020-05-30-Deep_learning_approach_for_text_classification_with_spacy.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/Blog-Posts/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/mani2106/Blog-Posts/master?filepath=_notebooks%2F2020-05-30-Deep_learning_approach_for_text_classification_with_spacy.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/Blog-Posts/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/mani2106/Blog-Posts/blob/master/_notebooks/2020-05-30-Deep_learning_approach_for_text_classification_with_spacy.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/Blog-Posts/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-container">
    <aside class="toc-sidebar">
      <!-- Enhanced Table of Contents with proper semantic HTML structure and accessibility -->
<div class="toc-container" role="complementary" aria-labelledby="toc-heading">
  <div class="toc-header">
    <h4 id="toc-heading" class="toc-title">Table of Contents</h4>
  </div>
  <nav class="toc-nav" aria-label="Table of Contents">
    <div id="toc" role="navigation"></div>
  </nav>
</div>

<script>
    // Performance optimization: Debounce utility for scroll handlers (Requirement 3.4)
    function debounce(func, wait, immediate) {
      var timeout;
      return function executedFunction() {
        var context = this;
        var args = arguments;
        var later = function() {
          timeout = null;
          if (!immediate) func.apply(context, args);
        };
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
      };
    }

    // Performance optimization: Throttle utility for high-frequency events
    function throttle(func, limit) {
      var inThrottle;
      return function() {
        var args = arguments;
        var context = this;
        if (!inThrottle) {
          func.apply(context, args);
          inThrottle = true;
          setTimeout(function() { inThrottle = false; }, limit);
        }
      };
    }

    // Performance optimization: RequestAnimationFrame polyfill for smooth animations
    (function() {
      var lastTime = 0;
      var vendors = ['ms', 'moz', 'webkit', 'o'];
      for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x] + 'CancelAnimationFrame'] ||
                                      window[vendors[x] + 'CancelRequestAnimationFrame'];
      }

      if (!window.requestAnimationFrame) {
        window.requestAnimationFrame = function(callback, element) {
          var currTime = new Date().getTime();
          var timeToCall = Math.max(0, 16 - (currTime - lastTime));
          var id = window.setTimeout(function() { callback(currTime + timeToCall); }, timeToCall);
          lastTime = currTime + timeToCall;
          return id;
        };
      }

      if (!window.cancelAnimationFrame) {
        window.cancelAnimationFrame = function(id) {
          clearTimeout(id);
        };
      }
    })();

    // Enhanced feature detection with polyfill support (Requirement 5.2)
    var features = {
      jquery: typeof jQuery !== 'undefined',
      cssGrid: (function() {
        try {
          return CSS && CSS.supports && CSS.supports('display', 'grid');
        } catch (e) {
          return false;
        }
      })(),
      stickyPosition: (function() {
        try {
          return CSS && CSS.supports && (
            CSS.supports('position', 'sticky') ||
            CSS.supports('position', '-webkit-sticky')
          );
        } catch (e) {
          return false;
        }
      })(),
      intersectionObserver: (function() {
        try {
          return 'IntersectionObserver' in window &&
                 typeof IntersectionObserver === 'function';
        } catch (e) {
          return false;
        }
      })(),
      smoothScroll: (function() {
        try {
          return 'scrollBehavior' in document.documentElement.style;
        } catch (e) {
          return false;
        }
      })(),
      // Additional performance-related feature detection
      passiveEvents: (function() {
        try {
          var opts = Object.defineProperty({}, 'passive', {
            get: function() {
              return true;
            }
          });
          window.addEventListener('testPassive', null, opts);
          window.removeEventListener('testPassive', null, opts);
          return true;
        } catch (e) {
          return false;
        }
      })(),
      requestAnimationFrame: typeof window.requestAnimationFrame === 'function'
    };

    // Log feature support for debugging
    console.log('TOC Feature Support:', features);

    // Apply graceful degradation classes based on feature support (Requirement 5.3)
    function applyFeatureDegradation() {
      var tocContainer = document.querySelector('.toc-container');
      if (!tocContainer) return;

      // Add classes for CSS to handle graceful degradation
      if (!features.cssGrid) {
        tocContainer.classList.add('no-css-grid');
      }
      if (!features.stickyPosition) {
        tocContainer.classList.add('no-sticky-position');
      }
      if (!features.intersectionObserver) {
        tocContainer.classList.add('no-intersection-observer');
      }
    }

    // Fallback TOC generation if jQuery plugin fails (Requirement 5.1)
    // Enhanced with stack-based algorithm for proper heading hierarchy (Requirements 4.1-4.5)
    function generateFallbackTOC() {
      try {
        // Select all heading levels H2-H6 (Requirement 4.1)
        var headers = document.querySelectorAll('h2, h3, h4, h5, h6');

        // Hide TOC if fewer than 2 headers (Requirement 1.4)
        if (headers.length < 2) {
          hideTOCContainer();
          return false;
        }

        var tocContainer = document.getElementById('toc');
        if (!tocContainer) {
          console.warn('TOC container not found');
          return false;
        }

        // Clear existing content
        tocContainer.innerHTML = '';

        // Build hierarchical structure using stack-based algorithm (Requirement 4.2, 4.3)
        var rootList = document.createElement('ul');
        var stack = [{ level: 1, list: rootList }]; // Stack to track nesting levels

        headers.forEach(function(header, index) {
          // Auto-generate IDs for headings without IDs (Requirement 4.4)
          if (!header.id) {
            header.id = 'toc-header-' + index;
          }

          var level = parseInt(header.tagName.charAt(1)); // Extract level (2-6)
          var listItem = document.createElement('li');
          var link = document.createElement('a');

          link.href = '#' + header.id;
          link.textContent = header.textContent || header.innerText;
          link.setAttribute('data-level', level);
          listItem.appendChild(link);

          // Handle non-sequential heading hierarchies gracefully (Requirement 4.3)
          // Find the correct parent level in the stack
          while (stack.length > 1 && stack[stack.length - 1].level >= level) {
            stack.pop();
          }

          // If we need to go deeper, create nested lists for proper indentation (Requirement 4.5)
          if (level > stack[stack.length - 1].level) {
            // Create nested list structure
            var nestedList = document.createElement('ul');
            var parentList = stack[stack.length - 1].list;

            // Append to last item in parent list, or to parent list if empty
            if (parentList.lastElementChild) {
              parentList.lastElementChild.appendChild(nestedList);
            } else {
              // Handle case where parent header is missing (non-sequential hierarchy)
              parentList.appendChild(nestedList);
            }

            // Push new level onto stack
            stack.push({ level: level, list: nestedList });
          }

          // Append item to current level
          stack[stack.length - 1].list.appendChild(listItem);
        });

        tocContainer.appendChild(rootList);

        // Add click handlers for smooth scrolling
        addFallbackScrollHandlers();

        console.log('Fallback TOC generated successfully with all heading levels (H2-H6)');
        return true;
      } catch (error) {
        console.error('Fallback TOC generation failed:', error);
        hideTOCContainer();
        return false;
      }
    }

    // Add smooth scrolling handlers for fallback TOC (Requirement 5.1)
    function addFallbackScrollHandlers() {
      var tocLinks = document.querySelectorAll('#toc a');

      tocLinks.forEach(function(link) {
        // Create named handler for cleanup
        var clickHandler = function(e) {
          try {
            e.preventDefault();

            var targetId = this.getAttribute('href').substring(1);
            var target = document.getElementById(targetId);

            if (target) {
              var offset = 32; // Account for sticky headers
              var targetPosition = target.offsetTop - offset;

              // Use smooth scroll if supported, otherwise fallback to instant scroll
              if (features.smoothScroll) {
                window.scrollTo({
                  top: targetPosition,
                  behavior: 'smooth'
                });
              } else {
                window.scrollTo(0, targetPosition);
              }
            }
          } catch (scrollError) {
            console.warn('Error in fallback scroll handler:', scrollError);
            // Allow default browser behavior as fallback
            return true;
          }
          return false;
        };

        // Store handler reference for cleanup
        link._tocClickHandler = clickHandler;
        link.addEventListener('click', clickHandler);
      });
    }

    // Hide TOC container when not needed (Requirement 1.4)
    function hideTOCContainer() {
      var tocContainer = document.querySelector('.toc-container');
      if (tocContainer) {
        tocContainer.style.display = 'none';
      }
    }

    // Show TOC container with loading state management
    function showTOCContainer() {
      var tocContainer = document.querySelector('.toc-container');
      if (tocContainer) {
        tocContainer.style.display = 'block';
        // Remove loading state if present
        tocContainer.classList.remove('toc-loading');
        tocContainer.classList.add('toc-loaded');
      }
    }

    // Add loading state to TOC container
    function showTOCLoading() {
      var tocContainer = document.querySelector('.toc-container');
      if (tocContainer) {
        tocContainer.classList.add('toc-loading');
        tocContainer.classList.remove('toc-loaded');

        // Add loading indicator
        var tocContent = document.getElementById('toc');
        if (tocContent) {
          tocContent.innerHTML = '<div class="toc-loading-indicator">' +
            '<div class="toc-spinner"></div>' +
            '<span>Generating table of contents...</span>' +
            '</div>';
        }
      }
    }

    // Performance optimization: Batch DOM operations for faster TOC generation
    function batchDOMOperations(operations) {
      if (features.requestAnimationFrame) {
        return new Promise(function(resolve) {
          requestAnimationFrame(function() {
            operations();
            resolve();
          });
        });
      } else {
        // Fallback for browsers without requestAnimationFrame
        return new Promise(function(resolve) {
          setTimeout(function() {
            operations();
            resolve();
          }, 0);
        });
      }
    }

    // Error recovery and cleanup utilities (Requirement 5.1)
    var tocErrorCount = 0;
    var maxRetries = 3;

    function handleTOCError(error, context) {
      tocErrorCount++;
      console.error('TOC Error in ' + context + ':', error);

      if (tocErrorCount >= maxRetries) {
        console.error('TOC initialization failed after ' + maxRetries + ' attempts, disabling TOC');
        hideTOCContainer();
        return false;
      }

      return true;
    }

    // Cross-browser compatibility: Array.from polyfill for IE11
    if (!Array.from) {
      Array.from = function(arrayLike) {
        var result = [];
        for (var i = 0; i < arrayLike.length; i++) {
          result.push(arrayLike[i]);
        }
        return result;
      };
    }

    // Cross-browser compatibility: forEach polyfill for NodeList in IE11
    if (window.NodeList && !NodeList.prototype.forEach) {
      NodeList.prototype.forEach = function(callback, thisArg) {
        thisArg = thisArg || window;
        for (var i = 0; i < this.length; i++) {
          callback.call(thisArg, this[i], i, this);
        }
      };
    }

    // Cross-browser compatibility: Object.assign polyfill for IE11
    if (typeof Object.assign !== 'function') {
      Object.assign = function(target) {
        if (target == null) {
          throw new TypeError('Cannot convert undefined or null to object');
        }
        var to = Object(target);
        for (var index = 1; index < arguments.length; index++) {
          var nextSource = arguments[index];
          if (nextSource != null) {
            for (var nextKey in nextSource) {
              if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {
                to[nextKey] = nextSource[nextKey];
              }
            }
          }
        }
        return to;
      };
    }

    // Enhanced cleanup function for memory management and performance
    function cleanupTOC() {
      try {
        // Performance optimization: Cancel any pending animation frames
        if (window.tocAnimationFrame) {
          cancelAnimationFrame(window.tocAnimationFrame);
          window.tocAnimationFrame = null;
        }

        // Remove event listeners to prevent memory leaks
        var tocLinks = document.querySelectorAll('#toc a');
        tocLinks.forEach(function(link) {
          if (link._tocClickHandler) {
            link.removeEventListener('click', link._tocClickHandler);
            delete link._tocClickHandler;
          }
        });

        // Clear any active observers
        if (window.tocObserver) {
          window.tocObserver.disconnect();
          window.tocObserver = null;
        }

        // Clear timeouts and intervals
        if (window.tocScrollTimeout) {
          clearTimeout(window.tocScrollTimeout);
          window.tocScrollTimeout = null;
        }
        if (window.tocResizeTimeout) {
          clearTimeout(window.tocResizeTimeout);
          window.tocResizeTimeout = null;
        }

        // Clear performance monitoring
        if (window.tocPerformanceStart) {
          window.tocPerformanceStart = null;
        }

        console.log('TOC cleanup completed');
      } catch (cleanupError) {
        console.warn('Error during TOC cleanup:', cleanupError);
      }
    }

    // Main TOC initialization with comprehensive error handling and performance optimization
    function initializeTOC() {
      try {
        // Performance optimization: Show loading state immediately
        showTOCLoading();

        // Clean up any previous initialization
        cleanupTOC();

        // Apply feature degradation classes first
        applyFeatureDegradation();

        // Performance optimization: Use requestAnimationFrame for non-blocking execution
        return batchDOMOperations(function() {
          // Check if we have enough headers (Requirement 1.4)
          var headers = document.querySelectorAll('h2, h3, h4, h5, h6');
          if (headers.length < 2) {
            console.log('TOC hidden: fewer than 2 headers found (' + headers.length + ')');
            hideTOCContainer();
            return;
          }

          console.log('Initializing TOC with ' + headers.length + ' headers');

          // Performance monitoring: Track TOC generation time
          window.tocPerformanceStart = performance && performance.now ? performance.now() : Date.now();

          var tocGenerated = false;

        // Try jQuery TOC plugin first if available
        if (features.jquery && typeof $ !== 'undefined' && $.fn && typeof $.fn.toc === 'function') {
          try {
            $('#toc').toc({
              minimumHeaders: 2,
              listType: 'ul',
              showSpeed: 0,
              headers: 'h2,h3,h4,h5,h6'
            });

            // Check if TOC was actually generated
            var tocContent = document.querySelector('#toc ul');
            if (tocContent && tocContent.children.length > 0) {
              tocGenerated = true;
              console.log('jQuery TOC plugin initialized successfully');

              // Enhanced smooth scrolling with proper offset calculation (Requirements 3.2, 3.3)
              $('#toc').on('click', 'a', function(e) {
                try {
                  e.preventDefault();
                  var target = $(this.getAttribute('href'));

                  if (target.length) {
                    var scroll_target = target.offset().top;
                    var offset = 32; // 2rem equivalent for sticky positioning

                    if (features.smoothScroll) {
                      $('html, body').animate({
                        scrollTop: scroll_target - offset
                      }, 300, 'swing');
                    } else {
                      // Fallback for browsers without smooth scroll
                      $('html, body').scrollTop(scroll_target - offset);
                    }
                  }
                } catch (scrollError) {
                  console.warn('Error in jQuery scroll handler:', scrollError);
                  // Fallback to browser default behavior
                  return true;
                }
                return false;
              });
            } else {
              console.warn('jQuery TOC plugin did not generate content');
            }
          } catch (jqueryError) {
            if (!handleTOCError(jqueryError, 'jQuery TOC plugin')) return;
          }
        } else {
          console.log('jQuery TOC plugin not available, using fallback');
        }

        // Fallback to vanilla JavaScript TOC generation if jQuery failed (Requirement 5.1)
        if (!tocGenerated) {
          console.log('Falling back to vanilla JavaScript TOC generation');
          try {
            tocGenerated = generateFallbackTOC();
          } catch (fallbackError) {
            if (!handleTOCError(fallbackError, 'fallback TOC generation')) return;
          }
        }

          if (tocGenerated) {
            try {
              // Initialize active section highlighting if supported (Requirements 3.1, 3.4)
              initializeActiveHighlighting();
              showTOCContainer();

              // Performance monitoring: Log completion time
              if (window.tocPerformanceStart) {
                var endTime = performance && performance.now ? performance.now() : Date.now();
                var duration = endTime - window.tocPerformanceStart;
                console.log('TOC initialization completed in ' + duration.toFixed(2) + 'ms');

                // Performance validation: Warn if TOC generation is slow (Requirement 3.4)
                if (duration > 50) {
                  console.warn('TOC generation took longer than expected (' + duration.toFixed(2) + 'ms). Consider optimizing for better performance.');
                }
              }

              // Validate final implementation against requirements
              validateTOCImplementation();

            } catch (highlightError) {
              // Active highlighting is optional, don't fail the entire TOC
              console.warn('Active highlighting failed, but TOC is still functional:', highlightError);
              showTOCContainer();
            }
          } else {
            console.warn('TOC generation failed, hiding container');
            hideTOCContainer();
          }
        }).catch(function(batchError) {
          console.error('Error in batched TOC operations:', batchError);
          hideTOCContainer();
        });

      } catch (error) {
        handleTOCError(error, 'main initialization');
      }
    }

    // Cleanup on page unload to prevent memory leaks
    window.addEventListener('beforeunload', cleanupTOC);

    // Validate final implementation against all requirements
    function validateTOCImplementation() {
      try {
        var validationResults = {
          requirement1_1: false, // TOC displays in right sidebar
          requirement1_2: false, // TOC remains sticky during scroll
          requirement1_3: false, // TOC hidden on mobile/tablet
          requirement1_4: false, // TOC hidden when fewer than 2 headers
          requirement3_1: false, // Active section highlighting
          requirement3_4: false, // Smooth scrolling with proper performance
          requirement4_1: false, // Consistent typography and colors
          requirement6_4: false  // Responsive behavior
        };

        // Check Requirement 1.1: TOC displays in right sidebar
        var tocSidebar = document.querySelector('.toc-sidebar');
        var tocContainer = document.querySelector('.toc-container');
        if (tocSidebar && tocContainer && tocContainer.style.display !== 'none') {
          validationResults.requirement1_1 = true;
        }

        // Check Requirement 1.2: Sticky positioning
        if (features.stickyPosition) {
          var stickyStyle = window.getComputedStyle(tocSidebar);
          if (stickyStyle.position === 'sticky' || stickyStyle.position === '-webkit-sticky') {
            validationResults.requirement1_2 = true;
          }
        } else {
          // Graceful degradation is acceptable
          validationResults.requirement1_2 = true;
        }

        // Check Requirement 1.3: Responsive behavior
        var mediaQuery = window.matchMedia('(max-width: 1024px)');
        if (mediaQuery.matches) {
          var tocDisplay = window.getComputedStyle(tocSidebar).display;
          if (tocDisplay === 'none') {
            validationResults.requirement1_3 = true;
          }
        } else {
          validationResults.requirement1_3 = true; // Not on mobile, so requirement is met
        }

        // Check Requirement 1.4: Hidden when fewer than 2 headers
        var headers = document.querySelectorAll('h2, h3, h4, h5, h6');
        if (headers.length >= 2) {
          validationResults.requirement1_4 = true; // TOC should be visible
        } else {
          // TOC should be hidden
          if (tocContainer && tocContainer.style.display === 'none') {
            validationResults.requirement1_4 = true;
          }
        }

        // Check Requirement 3.1: Active section highlighting
        var tocLinks = document.querySelectorAll('#toc a');
        var hasActiveClass = false;
        tocLinks.forEach(function(link) {
          if (link.classList.contains('toc-active')) {
            hasActiveClass = true;
          }
        });
        if (features.intersectionObserver || hasActiveClass) {
          validationResults.requirement3_1 = true;
        }

        // Check Requirement 3.4: Performance (scroll handlers are throttled)
        if (window.tocObserver || (window.addEventListener.toString().indexOf('throttle') > -1)) {
          validationResults.requirement3_4 = true;
        }

        // Check Requirement 4.1: Typography and colors
        if (tocContainer) {
          var containerStyles = window.getComputedStyle(tocContainer);
          if (containerStyles.fontFamily && containerStyles.color) {
            validationResults.requirement4_1 = true;
          }
        }

        // Check Requirement 6.4: Responsive adaptation
        validationResults.requirement6_4 = validationResults.requirement1_3;

        // Log validation results
        var passedCount = 0;
        var totalCount = 0;
        for (var req in validationResults) {
          totalCount++;
          if (validationResults[req]) {
            passedCount++;
          } else {
            console.warn('Requirement validation failed:', req);
          }
        }

        console.log('TOC Requirements Validation: ' + passedCount + '/' + totalCount + ' requirements met');

        if (passedCount === totalCount) {
          console.log('✅ All TOC requirements successfully validated');
        } else {
          console.warn('⚠️ Some TOC requirements not fully met - check console for details');
        }

        return validationResults;
      } catch (validationError) {
        console.error('Error during TOC validation:', validationError);
        return null;
      }
    }

    // Cross-browser compatibility: Performance monitoring fallback
    if (!window.performance || !window.performance.now) {
      window.performance = {
        now: function() {
          return Date.now();
        }
      };
    }

    // Initialize when DOM is ready with error handling
    function initializeTOCWhenReady() {
      try {
        if (features.jquery && typeof $ !== 'undefined') {
          $(document).ready(function() {
            setTimeout(initializeTOC, 0); // Non-blocking initialization
          });
        } else {
          // Fallback for when jQuery is not available
          if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
              setTimeout(initializeTOC, 0); // Non-blocking initialization
            });
          } else {
            setTimeout(initializeTOC, 0); // Non-blocking initialization
          }
        }
      } catch (initError) {
        console.error('Error setting up TOC initialization:', initError);
        // Fallback: try direct initialization
        setTimeout(function() {
          try {
            initializeTOC();
          } catch (fallbackError) {
            console.error('TOC fallback initialization also failed:', fallbackError);
          }
        }, 100);
      }
    }

    // Start initialization
    initializeTOCWhenReady();

    // Active section highlighting using Intersection Observer API (Requirement 3.1)
    function initializeActiveHighlighting() {
      try {
        // Check if Intersection Observer is supported (Requirement 5.2)
        if (!features.intersectionObserver) {
          console.warn('Intersection Observer not supported, using fallback scroll-based highlighting');
          initializeFallbackHighlighting();
          return;
        }

        var headers = document.querySelectorAll('h2, h3, h4, h5, h6');
        var tocLinks = document.querySelectorAll('#toc a');
        var activeClass = 'toc-active';

        if (headers.length === 0 || tocLinks.length === 0) {
          console.log('No headers or TOC links found for active highlighting');
          return;
        }

        // Create a map of header IDs to TOC links for efficient lookup
        var headerToLinkMap = {};
        tocLinks.forEach(function(link) {
          try {
            var href = link.getAttribute('href');
            if (href && href.startsWith('#')) {
              var headerId = href.substring(1);
              headerToLinkMap[headerId] = link;
            }
          } catch (linkError) {
            console.warn('Error processing TOC link:', linkError);
          }
        });

        // Intersection Observer configuration (Requirement 3.4)
        var observerOptions = {
          // Trigger when section is in the middle portion of viewport
          rootMargin: '-20% 0px -35% 0px',
          threshold: 0
        };

        // Track currently active section
        var currentActiveLink = null;

        // Intersection Observer callback (Requirement 3.1, 3.4)
        window.tocObserver = new IntersectionObserver(function(entries) {
          try {
            var visibleHeaders = [];

            // Collect all visible headers
            entries.forEach(function(entry) {
              if (entry.isIntersecting) {
                visibleHeaders.push({
                  element: entry.target,
                  ratio: entry.intersectionRatio,
                  top: entry.boundingClientRect.top
                });
              }
            });

            // Sort by position in viewport (topmost first)
            visibleHeaders.sort(function(a, b) {
              return a.top - b.top;
            });

            // Clear previous active state
            if (currentActiveLink) {
              currentActiveLink.classList.remove(activeClass);
              currentActiveLink = null;
            }

            // Set new active state for the topmost visible header (Requirement 3.4)
            if (visibleHeaders.length > 0) {
              var activeHeader = visibleHeaders[0].element;
              var activeLink = headerToLinkMap[activeHeader.id];

              if (activeLink) {
                activeLink.classList.add(activeClass);
                currentActiveLink = activeLink;
              }
            }
          } catch (observerError) {
            console.error('Error in Intersection Observer callback:', observerError);
          }
        }, observerOptions);

        // Start observing all headers (Requirement 3.1)
        headers.forEach(function(header, index) {
          try {
            // Ensure header has an ID for linking
            if (!header.id) {
              // Generate ID if missing (fallback)
              header.id = 'toc-header-' + index;
            }
            window.tocObserver.observe(header);
          } catch (headerError) {
            console.warn('Error observing header:', headerError);
          }
        });

        // Handle edge case: highlight first section when at top of page
        function handleScrollTop() {
          try {
            if (window.pageYOffset < 100 && tocLinks.length > 0) {
              // Clear all active states
              tocLinks.forEach(function(link) {
                link.classList.remove(activeClass);
              });

              // Activate first link
              tocLinks[0].classList.add(activeClass);
              currentActiveLink = tocLinks[0];
            }
          } catch (scrollError) {
            console.warn('Error in scroll top handler:', scrollError);
          }
        }

        // Optimized scroll handler with throttling for 60fps performance (Requirement 3.4)
        var optimizedScrollHandler = throttle(handleScrollTop, 16); // ~60fps
        var eventOptions = features.passiveEvents ? { passive: true } : false;

        window.addEventListener('scroll', optimizedScrollHandler, eventOptions);

        // Initial check
        handleScrollTop();

        console.log('Intersection Observer active highlighting initialized');

      } catch (error) {
        console.error('Error initializing active highlighting:', error);
        // Fallback to scroll-based highlighting
        initializeFallbackHighlighting();
      }
    }

    // Fallback active highlighting for browsers without Intersection Observer (Requirement 5.2, 5.3)
    function initializeFallbackHighlighting() {
      try {
        var headers = document.querySelectorAll('h2, h3, h4, h5, h6');
        var tocLinks = document.querySelectorAll('#toc a');
        var activeClass = 'toc-active';

        if (headers.length === 0 || tocLinks.length === 0) {
          return;
        }

        // Create header position cache for performance
        var headerPositions = [];

        function updateHeaderPositions() {
          headerPositions = Array.from(headers).map(function(header) {
            return {
              element: header,
              top: header.offsetTop,
              id: header.id
            };
          });
        }

        // Create header ID to link mapping
        var headerToLinkMap = {};
        tocLinks.forEach(function(link) {
          var href = link.getAttribute('href');
          if (href && href.startsWith('#')) {
            var headerId = href.substring(1);
            headerToLinkMap[headerId] = link;
          }
        });

        // Scroll-based active highlighting
        function updateActiveSection() {
          try {
            var scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            var currentActive = null;

            // Find the current section based on scroll position
            for (var i = headerPositions.length - 1; i >= 0; i--) {
              if (scrollTop >= headerPositions[i].top - 100) {
                currentActive = headerPositions[i];
                break;
              }
            }

            // Clear all active states
            tocLinks.forEach(function(link) {
              link.classList.remove(activeClass);
            });

            // Set active state
            if (currentActive && headerToLinkMap[currentActive.id]) {
              headerToLinkMap[currentActive.id].classList.add(activeClass);
            } else if (tocLinks.length > 0 && scrollTop < 100) {
              // Activate first link when at top
              tocLinks[0].classList.add(activeClass);
            }
          } catch (updateError) {
            console.warn('Error updating active section:', updateError);
          }
        }

        // Initialize header positions
        updateHeaderPositions();

        // Optimized scroll handler with throttling for 60fps performance (Requirement 3.4)
        var optimizedScrollHandler = throttle(updateActiveSection, 16); // ~60fps
        var eventOptions = features.passiveEvents ? { passive: true } : false;

        window.addEventListener('scroll', optimizedScrollHandler, eventOptions);

        // Optimized resize handler with debouncing
        var optimizedResizeHandler = debounce(updateHeaderPositions, 250);
        window.addEventListener('resize', optimizedResizeHandler, eventOptions);

        // Initial update
        updateActiveSection();

        console.log('Fallback scroll-based active highlighting initialized');

      } catch (error) {
        console.error('Error initializing fallback highlighting:', error);
      }
    }

    // TOC Resize Functionality with localStorage persistence (Requirements 3.4, 3.5, 3.6, 3.7)
    function initializeTOCResize() {
      try {
        var tocSidebar = document.querySelector('.toc-sidebar');
        if (!tocSidebar) {
          console.log('TOC sidebar not found, skipping resize initialization');
          return;
        }

        // Check if we're on mobile/tablet (resize should be disabled)
        var mediaQuery = window.matchMedia('(max-width: 1024px)');
        if (mediaQuery.matches) {
          console.log('Resize disabled on mobile/tablet devices');
          return;
        }

        // Restore saved width from localStorage (Requirement 3.5)
        try {
          var savedWidth = localStorage.getItem('toc-width');
          if (savedWidth) {
            var width = parseInt(savedWidth, 10);
            // Validate bounds (200-400px) (Requirement 3.6)
            if (width >= 200 && width <= 400) {
              tocSidebar.style.width = width + 'px';
              console.log('Restored TOC width from localStorage: ' + width + 'px');
            } else {
              console.warn('Saved TOC width out of bounds (' + width + 'px), using default');
            }
          }
        } catch (storageError) {
          console.warn('Could not restore TOC width from localStorage:', storageError);
        }

        // Use ResizeObserver to detect width changes (Requirement 3.6)
        if ('ResizeObserver' in window) {
          // Debounced save function to prevent excessive localStorage writes (Requirement 3.6)
          var debouncedSave = debounce(function(width) {
            try {
              localStorage.setItem('toc-width', Math.round(width));
              console.log('Saved TOC width to localStorage: ' + Math.round(width) + 'px');
            } catch (e) {
              console.warn('Could not save TOC width to localStorage:', e);
            }
          }, 300);

          var resizeObserver = new ResizeObserver(function(entries) {
            try {
              for (var i = 0; i < entries.length; i++) {
                var entry = entries[i];
                var width = entry.contentRect.width;

                // Enforce bounds (200-400px) (Requirement 3.6)
                if (width < 200) {
                  tocSidebar.style.width = '200px';
                  width = 200;
                } else if (width > 400) {
                  tocSidebar.style.width = '400px';
                  width = 400;
                }

                // Save to localStorage (debounced) (Requirement 3.5)
                debouncedSave(width);
              }
            } catch (observerError) {
              console.warn('Error in ResizeObserver callback:', observerError);
            }
          });

          resizeObserver.observe(tocSidebar);

          // Store observer reference for cleanup (Requirement 3.7)
          window.tocResizeObserver = resizeObserver;

          // Cleanup on page unload (Requirement 3.7)
          window.addEventListener('beforeunload', function() {
            if (window.tocResizeObserver) {
              window.tocResizeObserver.disconnect();
              window.tocResizeObserver = null;
              console.log('TOC ResizeObserver disconnected');
            }
          });

          console.log('TOC resize functionality initialized with ResizeObserver');
        } else {
          // Graceful degradation when ResizeObserver is not supported (Requirement 3.7)
          console.warn('ResizeObserver not supported - resize will work but without bounds enforcement or localStorage persistence');
        }

      } catch (error) {
        console.error('Error initializing TOC resize functionality:', error);
      }
    }

    // Initialize resize functionality after TOC is loaded
    // This should be called after the TOC is generated
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initializeTOCResize, 100); // Small delay to ensure TOC is rendered
      });
    } else {
      setTimeout(initializeTOCResize, 100); // Small delay to ensure TOC is rendered
    }
</script>

    </aside>
    <main class="post-main">
      <div class="post-content e-content" itemprop="articleBody">
        <!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-05-30-Deep_learning_approach_for_text_classification_with_spacy.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Setup-paths">Setup paths<a class="anchor-link" href="#Setup-paths"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will use the method from my previous <a href="https://mani2106.github.io/Blog-Posts/nlp/eda/sentiment/2020/05/23/_Hackerearth_mothers_day_sentiment.html">post</a> to clean the text.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;dataset/&#39;</span><span class="p">)</span>
<span class="n">DRIVE_PATH</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/content/drive/My Drive/Spacy/Pretrained&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="o">/</span><span class="s1">&#39;train.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">train_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>original_text</th>
      <th>lang</th>
      <th>retweet_count</th>
      <th>original_author</th>
      <th>sentiment_class</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.245025e+18</th>
      <td>Happy #MothersDay to all you amazing mothers o...</td>
      <td>en</td>
      <td>0</td>
      <td>BeenXXPired</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1.245759e+18</th>
      <td>Happy Mothers Day Mum - I'm sorry I can't be t...</td>
      <td>en</td>
      <td>1</td>
      <td>FestiveFeeling</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1.246087e+18</th>
      <td>Happy mothers day To all This doing a mothers ...</td>
      <td>en</td>
      <td>0</td>
      <td>KrisAllenSak</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1.244803e+18</th>
      <td>Happy mothers day to this beautiful woman...ro...</td>
      <td>en</td>
      <td>0</td>
      <td>Queenuchee</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1.244876e+18</th>
      <td>Remembering the 3 most amazing ladies who made...</td>
      <td>en</td>
      <td>0</td>
      <td>brittan17446794</td>
      <td>-1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's check average length of text before cleaning.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span>
    <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="p">)</span><span class="o">/</span><span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>227.42102009273572
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clean-links-with-regex">Clean links with regex<a class="anchor-link" href="#Clean-links-with-regex"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="c1"># Regex is match : the text to replace with</span>
    <span class="p">{</span><span class="s1">&#39;(https?:\/\/.*|pic.*)[</span><span class="se">\r\n</span><span class="s1">]*&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's check the average length again.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The regex did it's job I suppose.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>original_text</th>
      <th>lang</th>
      <th>retweet_count</th>
      <th>original_author</th>
      <th>sentiment_class</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.245025e+18</th>
      <td>Happy #MothersDay to all you amazing mothers o...</td>
      <td>en</td>
      <td>0</td>
      <td>BeenXXPired</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1.245759e+18</th>
      <td>Happy Mothers Day Mum - I'm sorry I can't be t...</td>
      <td>en</td>
      <td>1</td>
      <td>FestiveFeeling</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1.246087e+18</th>
      <td>Happy mothers day To all This doing a mothers ...</td>
      <td>en</td>
      <td>0</td>
      <td>KrisAllenSak</td>
      <td>-1</td>
    </tr>
    <tr>
      <th>1.244803e+18</th>
      <td>Happy mothers day to this beautiful woman...ro...</td>
      <td>en</td>
      <td>0</td>
      <td>Queenuchee</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1.244876e+18</th>
      <td>Remembering the 3 most amazing ladies who made...</td>
      <td>en</td>
      <td>0</td>
      <td>brittan17446794</td>
      <td>-1</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In my previous exploratory <a href="https://mani2106.github.io/Blog-Posts/nlp/eda/sentiment/2020/05/23/_Hackerearth_mothers_day_sentiment.html">post</a>, I have seen the data and I think that the features other than the text may not be required, (ie)</p>
<ul>
<li>lang</li>
<li>retweet_count</li>
<li>original_author</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Class-distribution">Class distribution<a class="anchor-link" href="#Class-distribution"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li><code>0</code> must mean <code>Neutral</code></li>
<li><code>1</code> means <code>Positive</code></li>
<li><code>-1</code> means <code>Negative</code></li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7f2681b9b438&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAX0AAAD4CAYAAAAAczaOAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAADh0RVh0U29mdHdhcmUAbWF0cGxvdGxpYiB2ZXJzaW9uMy4yLjEsIGh0dHA6Ly9tYXRwbG90bGliLm9yZy+j8jraAAAQ1ElEQVR4nO3df4xlZX3H8fenbMGqqYA7rri7djd11aCpkUyRxrRRafmlcflDDaQtW0uzaQtWq6mCTUqipcHalGpqSVbZCo0BibWyUSrdopY0LciAiiyITFDc2YA7CtIfRHH12z/moV6HmZ2de2fvAM/7lUzmnO/z3Hu+N5N87slzz52TqkKS1IefWe0GJEnjY+hLUkcMfUnqiKEvSR0x9CWpI2tWu4GDWbt2bW3atGm125CkJ5Vbb731O1U1sdDYEzr0N23axNTU1Gq3IUlPKknuW2zM5R1J6oihL0kdMfQlqSOGviR1xNCXpI4Y+pLUEUNfkjpi6EtSRwx9SerIE/obueO26YLPrHYLh9U3L3ntarcgaZV5pi9JHTH0Jakjhr4kdcTQl6SOGPqS1BFDX5I6YuhLUkcMfUnqyJKhn2Rnkv1J7phXf0uSryXZk+QvB+oXJplOcneSUwfqp7XadJILVvZlSJIOxaF8I/ejwN8CVz5WSPJqYCvwsqr6QZLntPrxwFnAS4DnAf+a5IXtYR8CfgOYAW5Jsquq7lypFyJJWtqSoV9VNybZNK/8B8AlVfWDNmd/q28Frm71bySZBk5sY9NVdS9AkqvbXENfksZo2DX9FwK/muTmJP+W5JdbfT2wd2DeTKstVn+cJNuTTCWZmp2dHbI9SdJChg39NcCxwEnAnwDXJMlKNFRVO6pqsqomJyYmVuIpJUnNsP9lcwb4ZFUV8MUkPwbWAvuAjQPzNrQaB6lLksZk2DP9TwGvBmgf1B4JfAfYBZyV5Kgkm4EtwBeBW4AtSTYnOZK5D3t3jdq8JGl5ljzTT3IV8CpgbZIZ4CJgJ7CzXcb5KLCtnfXvSXINcx/QHgDOq6oftec5H7geOALYWVV7DsPrkSQdxKFcvXP2IkO/tcj8i4GLF6hfB1y3rO4kSSvKb+RKUkcMfUnqiKEvSR0x9CWpI4a+JHXE0Jekjhj6ktQRQ1+SOmLoS1JHDH1J6oihL0kdMfQlqSOGviR1xNCXpI4Y+pLUkSVDP8nOJPvbDVPmj70jSSVZ2/aT5INJppPcnuSEgbnbktzTfrat7MuQJB2KQznT/yhw2vxiko3AKcC3BsqnM3eLxC3AduCyNvdY5u649QrgROCiJMeM0rgkafmWDP2quhF4cIGhS4F3AjVQ2wpcWXNuAo5OchxwKrC7qh6sqoeA3SzwRiJJOryGWtNPshXYV1VfmTe0Htg7sD/TaovVF3ru7UmmkkzNzs4O054kaRHLDv0kTwfeDfzZyrcDVbWjqiaranJiYuJwHEKSujXMmf4vApuBryT5JrABuC3Jc4F9wMaBuRtabbG6JGmMlh36VfXVqnpOVW2qqk3MLdWcUFUPALuAc9pVPCcBD1fV/cD1wClJjmkf4J7SapKkMTqUSzavAv4TeFGSmSTnHmT6dcC9wDTwYeAPAarqQeC9wC3t5z2tJkkaozVLTaiqs5cY3zSwXcB5i8zbCexcZn+SpBXkN3IlqSOGviR1xNCXpI4Y+pLUEUNfkjpi6EtSRwx9SeqIoS9JHTH0Jakjhr4kdcTQl6SOGPqS1BFDX5I6YuhLUkcMfUnqiKEvSR05lDtn7UyyP8kdA7X3J/laktuT/FOSowfGLkwyneTuJKcO1E9rtekkF6z8S5EkLeVQzvQ/Cpw2r7YbeGlV/RLwdeBCgCTHA2cBL2mP+bskRyQ5AvgQcDpwPHB2mytJGqMlQ7+qbgQenFf7l6o60HZvAja07a3A1VX1g6r6BnP3yj2x/UxX1b1V9ShwdZsrSRqjlVjT/13gn9v2emDvwNhMqy1Wf5wk25NMJZmanZ1dgfYkSY8ZKfST/ClwAPjYyrQDVbWjqiaranJiYmKlnlaSBKwZ9oFJfgd4HXByVVUr7wM2Dkzb0GocpC5JGpOhzvSTnAa8E3h9VT0yMLQLOCvJUUk2A1uALwK3AFuSbE5yJHMf9u4arXVJ0nIteaaf5CrgVcDaJDPARcxdrXMUsDsJwE1V9ftVtSfJNcCdzC37nFdVP2rPcz5wPXAEsLOq9hyG1yNJOoglQ7+qzl6gfPlB5l8MXLxA/TrgumV1J0laUX4jV5I6YuhLUkcMfUnqiKEvSR0x9CWpI4a+JHXE0Jekjhj6ktQRQ1+SOmLoS1JHDH1J6oihL0kdMfQlqSOGviR1xNCXpI4sGfpJdibZn+SOgdqxSXYnuaf9PqbVk+SDSaaT3J7khIHHbGvz70my7fC8HEnSwRzKmf5HgdPm1S4AbqiqLcANbR/gdOZukbgF2A5cBnNvEszdcesVwInARY+9UUiSxmfJ0K+qG4EH55W3Ale07SuAMwfqV9acm4CjkxwHnArsrqoHq+ohYDePfyORJB1mw67pr6uq+9v2A8C6tr0e2Dswb6bVFqs/TpLtSaaSTM3Ozg7ZniRpISN/kFtVBdQK9PLY8+2oqsmqmpyYmFipp5UkMXzof7st29B+72/1fcDGgXkbWm2xuiRpjIYN/V3AY1fgbAOuHaif067iOQl4uC0DXQ+ckuSY9gHuKa0mSRqjNUtNSHIV8CpgbZIZ5q7CuQS4Jsm5wH3Am9r064AzgGngEeDNAFX1YJL3Are0ee+pqvkfDkuSDrMlQ7+qzl5k6OQF5hZw3iLPsxPYuazuJEkrym/kSlJHDH1J6oihL0kdMfQlqSOGviR1xNCXpI4Y+pLUEUNfkjpi6EtSRwx9SeqIoS9JHTH0Jakjhr4kdcTQl6SOGPqS1JGRQj/JHyfZk+SOJFcleVqSzUluTjKd5ONJjmxzj2r7021800q8AEnSoRs69JOsB/4ImKyqlwJHAGcB7wMuraoXAA8B57aHnAs81OqXtnmSpDEadXlnDfBzSdYATwfuB14DfKKNXwGc2ba3tn3a+MlJMuLxJUnLMHToV9U+4K+AbzEX9g8DtwLfq6oDbdoMsL5trwf2tsceaPOfPf95k2xPMpVkanZ2dtj2JEkLGGV55xjmzt43A88DngGcNmpDVbWjqiaranJiYmLUp5MkDRhleefXgW9U1WxV/RD4JPBK4Oi23AOwAdjXtvcBGwHa+LOA745wfEnSMo0S+t8CTkry9LY2fzJwJ/B54A1tzjbg2ra9q+3Txj9XVTXC8SVJy7Rm6SkLq6qbk3wCuA04AHwJ2AF8Brg6yZ+32uXtIZcD/5BkGniQuSt9pBWz6YLPrHYLh9U3L3ntaregp4ChQx+gqi4CLppXvhc4cYG53wfeOMrxJD11PZXftJ9Ib9h+I1eSOmLoS1JHDH1J6oihL0kdMfQlqSOGviR1xNCXpI4Y+pLUEUNfkjpi6EtSRwx9SeqIoS9JHTH0Jakjhr4kdcTQl6SOGPqS1JGRQj/J0Uk+keRrSe5K8itJjk2yO8k97fcxbW6SfDDJdJLbk5ywMi9BknSoRj3T/wDw2ap6MfAy4C7gAuCGqtoC3ND2AU4HtrSf7cBlIx5bkrRMQ4d+kmcBv0a7B25VPVpV3wO2Ale0aVcAZ7btrcCVNecm4Ogkxw3duSRp2UY5098MzAJ/n+RLST6S5BnAuqq6v815AFjXttcDewceP9NqPyXJ9iRTSaZmZ2dHaE+SNN8oob8GOAG4rKpeDvwvP1nKAaCqCqjlPGlV7aiqyaqanJiYGKE9SdJ8o4T+DDBTVTe3/U8w9ybw7ceWbdrv/W18H7Bx4PEbWk2SNCZDh35VPQDsTfKiVjoZuBPYBWxrtW3AtW17F3BOu4rnJODhgWUgSdIYrBnx8W8BPpbkSOBe4M3MvZFck+Rc4D7gTW3udcAZwDTwSJsrSRqjkUK/qr4MTC4wdPICcws4b5TjSZJG4zdyJakjhr4kdcTQl6SOGPqS1BFDX5I6YuhLUkcMfUnqiKEvSR0x9CWpI4a+JHXE0Jekjhj6ktQRQ1+SOmLoS1JHDH1J6sjIoZ/kiHZj9E+3/c1Jbk4yneTj7QYrJDmq7U+38U2jHluStDwrcab/VuCugf33AZdW1QuAh4BzW/1c4KFWv7TNkySN0Uihn2QD8FrgI20/wGuYu0k6wBXAmW17a9unjZ/c5kuSxmTUM/2/Ad4J/LjtPxv4XlUdaPszwPq2vR7YC9DGH27zf0qS7UmmkkzNzs6O2J4kadDQoZ/kdcD+qrp1BfuhqnZU1WRVTU5MTKzkU0tS90a5MforgdcnOQN4GvDzwAeAo5OsaWfzG4B9bf4+YCMwk2QN8CzguyMcX5K0TEOf6VfVhVW1oao2AWcBn6uq3wQ+D7yhTdsGXNu2d7V92vjnqqqGPb4kafkOx3X67wLenmSauTX7y1v9cuDZrf524ILDcGxJ0kGMsrzz/6rqC8AX2va9wIkLzPk+8MaVOJ4kaTh+I1eSOmLoS1JHDH1J6oihL0kdMfQlqSOGviR1xNCXpI4Y+pLUEUNfkjpi6EtSRwx9SeqIoS9JHTH0Jakjhr4kdcTQl6SOjHKP3I1JPp/kziR7kry11Y9NsjvJPe33Ma2eJB9MMp3k9iQnrNSLkCQdmlHO9A8A76iq44GTgPOSHM/cHbFuqKotwA385A5ZpwNb2s924LIRji1JGsIo98i9v6pua9v/DdwFrAe2Ale0aVcAZ7btrcCVNecm5m6gftzQnUuSlm1F1vSTbAJeDtwMrKuq+9vQA8C6tr0e2DvwsJlWm/9c25NMJZmanZ1difYkSc3IoZ/kmcA/Am+rqv8aHKuqAmo5z1dVO6pqsqomJyYmRm1PkjRgpNBP8rPMBf7HquqTrfztx5Zt2u/9rb4P2Djw8A2tJkkak1Gu3glwOXBXVf31wNAuYFvb3gZcO1A/p13FcxLw8MAykCRpDNaM8NhXAr8NfDXJl1vt3cAlwDVJzgXuA97Uxq4DzgCmgUeAN49wbEnSEIYO/ar6dyCLDJ+8wPwCzhv2eJKk0fmNXEnqiKEvSR0x9CWpI4a+JHXE0Jekjhj6ktQRQ1+SOmLoS1JHDH1J6oihL0kdMfQlqSOGviR1xNCXpI4Y+pLUEUNfkjpi6EtSR8Ye+klOS3J3kukkF4z7+JLUs7GGfpIjgA8BpwPHA2cnOX6cPUhSz8Z9pn8iMF1V91bVo8DVwNYx9yBJ3RrlxujDWA/sHdifAV4xOCHJdmB72/2fJHePqbfVsBb4zrgOlveN60jd8O/35PVU/9v9wmID4w79JVXVDmDHavcxDkmmqmpytfvQcPz7PXn1/Lcb9/LOPmDjwP6GVpMkjcG4Q/8WYEuSzUmOBM4Cdo25B0nq1liXd6rqQJLzgeuBI4CdVbVnnD08wXSxjPUU5t/vyavbv12qarV7kCSNid/IlaSOGPqS1BFDX5I68oS7Tv+pLMmLmfsG8vpW2gfsqqq7Vq8rST3xTH9MkryLuX87EeCL7SfAVf7juSevJM9c7R40miRvXu0exsmrd8YkydeBl1TVD+fVjwT2VNWW1elMo0jyrap6/mr3oeH19jd0eWd8fgw8D7hvXv24NqYnqCRvX2wI8Ez/SSDJ7YsNAevG2ctqM/TH523ADUnu4Sf/dO75wAuA81etKx2KvwDeDxxYYMwl0ieHdcCpwEPz6gH+Y/ztrB5Df0yq6rNJXsjcv5ce/CD3lqr60ep1pkNwG/Cpqrp1/kCS31uFfrR8nwaeWVVfnj+Q5Avjb2f1uKYvLSHJi4DvVtV3BmrPraoHkqyrqm+vYnvSshj60hCS3FZVJ6x2H9JyuR4pDSer3YA0DENfGs6HV7sBaRgu70hSRzzTl6SOGPqS1BFDX5I6YuhLUkf+Dx6Pa2YHeRbzAAAAAElFTkSuQmCC
" />
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's see some sentences with negative examples, I am interested why they should be negative on a happy day(Mother's day)</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">list_of_neg_sents</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pprint</span><span class="p">(</span><span class="n">list_of_neg_sents</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;Happy mothers day To all This doing a mothers days work. Today been quiet &#39;
 &#39;but Had time to reflect. Dog walk, finish a jigsaw do the garden, learn few &#39;
 &#39;more guitar chords, drunk some strawberry gin and tonic and watch Lee evens &#39;
 &#39;on DVD. My favourite place to visit. #isolate &#39;,
 &#39;Remembering the 3 most amazing ladies who made me who I am! My late &#39;
 &#39;grandmother iris, mum carol and great grandmother Ethel. Missed but never &#39;
 &#39;forgotten! Happy mothers day to all those great mums out there! Love sent to &#39;
 &#39;all xxxx &#39;,
 &#39;Happy Mothers Day to everyone tuning in. This is the 4th Round game between &#39;
 &#39;me and @CastigersJ Live coverage on @Twitter , maybe one day @SkySportsRL or &#39;
 &#39;on the OurLeague app&#39;,
 &#34;Happy Mothers Day ! We hope your mums aren&#39;t planning to do any work around &#34;
 &#39;the house today! Surely it can wait until next week? #plumbers &#39;
 &#39;#heatingspecialists #mothersday #mothersday &#39;,
 &#34;Happy mothers day to all those mums whos children can&#39;t be with them today. &#34;
 &#39;My son Dylan lives in heaven I wish I could see him for one more hug. I wish &#39;
 &#39;I could tell him how much I love and miss him. Huge happy mothers day to &#39;
 &#39;your mum too.&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Well some tweets actually express their feelings for their deceased mothers. This is understandable.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can use traditional NLP methods or deep learning methods to model the text. We will try the deep learning in this notebook .</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Deep-Learning-approach-with-Spacy">Deep Learning approach with Spacy<a class="anchor-link" href="#Deep-Learning-approach-with-Spacy"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It's recommended <a href="https://spacy.io/usage/training#transfer-learning">here</a> that to improve performance of the classifier, <strong>Language model pretraining</strong> is one way to do so.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Spacy requires a <code>.jsonl</code> format of input to train text</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Get texts from the dataframe and store in <code>jsonl</code> format more about that <a href="https://spacy.io/api/cli#pretrain-jsonl">here</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can also load the test data to get some more sample for the <code>pretraining</code>, this will not cause <strong>Data Leakage</strong> because we are not giving any labels to the model.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="o">/</span><span class="s1">&#39;test.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>original_text</th>
      <th>lang</th>
      <th>retweet_count</th>
      <th>original_author</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.246628e+18</th>
      <td>3. Yeah, I once cooked potatoes when I was 3 y...</td>
      <td>en</td>
      <td>0</td>
      <td>LToddWood</td>
    </tr>
    <tr>
      <th>1.245898e+18</th>
      <td>Happy Mother's Day to all the mums, step-mums,...</td>
      <td>en</td>
      <td>0</td>
      <td>iiarushii</td>
    </tr>
    <tr>
      <th>1.244717e+18</th>
      <td>I love the people from the UK, however, when I...</td>
      <td>en</td>
      <td>0</td>
      <td>andreaanderegg</td>
    </tr>
    <tr>
      <th>1.245730e+18</th>
      <td>Happy 81st Birthday Happy Mother’s Day to my m...</td>
      <td>en</td>
      <td>1</td>
      <td>TheBookTweeters</td>
    </tr>
    <tr>
      <th>1.244636e+18</th>
      <td>Happy Mothers day to all those wonderful mothe...</td>
      <td>en</td>
      <td>0</td>
      <td>andreaanderegg</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's clean the test set for links as well</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="c1"># Regex pattern to match : the text to replace with</span>
    <span class="p">{</span><span class="s1">&#39;(https?:\/\/.*|pic.*)[</span><span class="se">\r\n</span><span class="s1">]*&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1387, 4)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">texts_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">],</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;rows&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's check the length</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">texts_series</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">train_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">test_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(4622, 4622)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So now we can use this <code>texts_series</code> to create the <code>jsonl</code> file.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">list_of_texts</span> <span class="o">=</span> <span class="p">[</span>
                 <span class="c1"># Form dictionary with &#39;text&#39; key</span>
                 <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
                 <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">texts_series</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I will use <code>srsly</code> to write this list of dictionaries to a <code>jsonl</code> file</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">srsly</span>
<span class="c1"># saving to my Google drive</span>
<span class="n">srsly</span><span class="o">.</span><span class="n">write_jsonl</span><span class="p">(</span><span class="n">DRIVE_PATH</span><span class="o">/</span><span class="s1">&#39;pretrain_texts.jsonl&#39;</span><span class="p">,</span> <span class="n">list_of_texts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see a few lines from the saved file.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">DRIVE_PATH</span><span class="o">/</span><span class="s1">&#39;pretrain_texts.jsonl&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="nb">next</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[&#39;{&#34;text&#34;:&#34;Happy #MothersDay to all you amazing mothers out there! I know &#39;
 &#34;it&#39;s hard not being able to see your mothers today but it&#39;s on all of us to &#34;
 &#39;do what we can to protect the most vulnerable members of our society. &#39;
 &#39;#BeatCoronaVirus &#34;}\n&#39;,
 &#39;{&#34;text&#34;:&#34;Happy Mothers Day Mum - I\&#39;m sorry I can\&#39;t be there to bring you &#39;
 &#34;Mothers day flowers &amp; a cwtch - honestly at this point I&#39;d walk on hot coals &#34;
 &#34;to be able to. But I&#39;ll be there with bells on as soon as I can be. Love you &#34;
 &#39;lots xxx (p.s we need more photos!) &#34;}\n&#39;,
 &#39;{&#34;text&#34;:&#34;Happy mothers day To all This doing a mothers days work. Today been &#39;
 &#39;quiet but Had time to reflect. Dog walk, finish a jigsaw do the garden, &#39;
 &#39;learn few more guitar chords, drunk some strawberry gin and tonic and watch &#39;
 &#39;Lee evens on DVD. My favourite place to visit. #isolate &#34;}\n&#39;,
 &#39;{&#34;text&#34;:&#34;Happy mothers day to this beautiful woman...royalty soothes you &#39;
 &#39;mummy jeremy and emerald and more #PrayForRoksie #UltimateLoveNG &#34;}\n&#39;,
 &#39;{&#34;text&#34;:&#34;Remembering the 3 most amazing ladies who made me who I am! My late &#39;
 &#39;grandmother iris, mum carol and great grandmother Ethel. Missed but never &#39;
 &#39;forgotten! Happy mothers day to all those great mums out there! Love sent to &#39;
 &#39;all xxxx &#34;}\n&#39;]
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Start-Pretraining">Start Pretraining<a class="anchor-link" href="#Start-Pretraining"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We should download a pretrained to model to use, Here I am using _en_core_web<em>md</em> from <code>Spacy</code>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This can be confusing (ie) Why should I train a pretrained model, if I can download one, The idea is that the downloaded pretrained model would have been trained with a <strong>very different</strong> type of dataset, but it already has some knowledge on interpreting words in English sentences.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>But here we have dataset of tweets which the downloaded pretrained model may or may not have seen during it's training, So we use our dataset to <strong>fine-tune</strong> the downloaded model, so that with minimum training it can start understanding the tweets right away.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python -m spacy download en_core_web_md
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Training-results">Training results<a class="anchor-link" href="#Training-results"> </a></h4>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>%%bash
<span class="c1"># Command to pretrain a language model</span>
<span class="c1"># Path to jsonl file with data</span>
<span class="c1"># Using md model as the base</span>
<span class="c1"># saving the model on my Drive folder</span>
<span class="c1"># training for 50 iterations with seed set to 0</span>
python -m spacy pretrain /content/drive/My<span class="se">\ </span>Drive/Spacy/Pretrained/pretrain_texts.jsonl <span class="se">\</span>
    /usr/local/lib/python3.6/dist-packages/en_core_web_md/en_core_web_md-2.2.5 <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/Pretrained/ <span class="se">\</span>
    -i <span class="m">50</span> -s <span class="m">0</span> <span class="se">\</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-blue-fg">ℹ Not using GPU</span>
<span class="ansi-yellow-fg">⚠ Output directory is not empty</span>
It is better to use an empty directory or refer to a new output path, then the
new directory will be created for you.
<span class="ansi-green-fg">✔ Saved settings to config.json</span>
<span class="ansi-green-fg">✔ Loaded input texts</span>
<span class="ansi-green-fg">✔ Loaded model
&#39;/usr/local/lib/python3.6/dist-packages/en_core_web_md/en_core_web_md-2.2.5&#39;</span>
<span class="ansi-bold">
============== Pre-training tok2vec layer - starting at epoch 0 ==============</span>
  #      # Words   Total Loss     Loss    w/s
  0       115177   114619.719   114619   7308
  0       177090   174673.695    60053   8123
  1       291933   282095.656   107421   8353
  1       354180   337893.113    55797   8156
  2       468951   432705.457    94812   8398
  2       531270   479373.527    46668   8271
  3       646206   557380.137    78006   8368
  3       708360   595962.348    38582   8151
  4       823108   662773.332    66810   8349
  4       885450   696823.672    34050   8125
  5      1000591   756743.684    59920   8254
  5      1062540   787816.266    31072   7943
  6      1177552   844198.828    56382   8380
  6      1239630   874128.219    29929   7996
  7      1354814   928725.262    54597   8291
  7      1416720   957604.215    28878   8081
  8      1531685   1010607.96    53003   8310
  8      1593810   1039022.08    28414   8006
  9      1708981   1091185.60    52163   8248
  9      1770900   1118857.03    27671   8032
 10      1885776   1169906.66    51049   8240
 10      1947990   1197361.49    27454   8015
 11      2062486   1247384.96    50023   8344
 11      2125080   1274605.26    27220   8153
 12      2239188   1323843.16    49237   8376
 12      2302170   1350702.81    26859   7941
 13      2416942   1399298.78    48595   8213
 13      2479260   1425267.50    25968   7968
 14      2594827   1473118.10    47850   8357
 14      2656350   1498307.73    25189   7879
 15      2770909   1544661.96    46354   7572
 15      2833440   1569846.84    25184   7980
 16      2948496   1615382.64    45535   8137
 16      3010530   1639715.23    24332   7848
 17      3125700   1684541.43    44826   8316
 17      3187620   1708564.64    24023   7941
 18      3302357   1753053.58    44488   8039
 18      3364710   1776999.23    23945   7234
 19      3480485   1821211.88    44212   8191
 19      3541800   1844436.19    23224   7859
 20      3657480   1887923.85    43487   8170
 20      3718890   1911031.40    23107   7902
 21      3833871   1954109.82    43078   8253
 21      3895980   1977017.92    22908   7840
 22      4011686   2019201.90    42183   8096
 22      4073070   2041539.05    22337   7906
 23      4188348   2083159.02    41619   8148
 23      4250160   2105332.99    22173   7882
 24      4364945   2146261.39    40928   8127
 24      4427250   2168323.78    22062   8017
 25      4542920   2209202.75    40878   8059
 25      4604340   2230725.28    21522   7823
 26      4719450   2271131.96    40406   8272
 26      4781430   2292648.11    21516   7986
 27      4896609   2332466.73    39818   8243
 27      4958520   2353768.18    21301   8030
 28      5073022   2392817.96    39049   8217
 28      5135610   2414267.76    21449   8032
 29      5250013   2452981.53    38713   8250
 29      5312700   2474212.04    21230   8098
 30      5427418   2512822.70    38610   8251
 30      5489790   2533517.18    20694   8083
 31      5604738   2572000.05    38482   8291
 31      5666880   2592500.56    20500   8071
 32      5781993   2630529.82    38029   8278
 32      5843970   2651013.32    20483   8080
 33      5959305   2689165.69    38152   8269
 33      6021060   2709293.04    20127   8086
 34      6136501   2746749.93    37456   8278
 34      6198150   2766661.32    19911   8105
 35      6313772   2803964.79    37303   8262
 35      6375240   2823781.55    19816   8095
 36      6490354   2860641.99    36860   8235
 36      6552330   2880476.80    19834   8056
 37      6667255   2917062.19    36585   8231
 37      6729420   2936732.01    19669   8108
 38      6844248   2972992.59    36260   8276
 38      6906510   2992718.12    19725   8074
 39      7021001   3028854.93    36136   8275
 39      7083600   3048416.73    19561   8092
 40      7199191   3084584.77    36168   8304
 40      7260690   3103795.33    19210   8085
 41      7375380   3139675.02    35879   8276
 41      7437780   3158848.65    19173   8136
 42      7552544   3194214.46    35365   8276
 42      7614870   3213532.30    19317   8072
 43      7730130   3248964.60    35432   7724
 43      7791960   3267930.77    18966   8096
 44      7906035   3302653.15    34722   8263
 44      7969050   3321900.34    19247   8103
 45      8083488   3356590.95    34690   8251
 45      8146140   3375484.65    18893   8084
 46      8261612   3410429.05    34944   8228
 46      8323230   3429043.30    18614   8121
 47      8437925   3463440.15    34396   8268
 47      8500320   3482173.21    18733   7931
 48      8615136   3516342.36    34169   8294
 48      8677410   3534982.44    18640   8098
 49      8791889   3568641.36    33658   8265
 49      8854500   3587280.92    18639   8102
<span class="ansi-yellow-fg">⚠ Skipped 250 empty values</span>
<span class="ansi-green-fg">✔ Successfully finished pretrain</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I have chosen to use the default parameters however one might need to change them for their problem.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see from the logs that the loss value in the last iteration is <code>18639</code>, but since the batch_size was <code>3000</code> our data must have splitted to <code>2</code> batches, (number of texts are <code>4622</code>) we should also take the previous log entry to account which is loss of <code>33658</code>, So the average of them would be <code>26148.5</code>, This number might be intimidating but the only way to check if it actually helps is to try to train a model with it.</p>

<pre><code>If it doesn't then we can resume the training from the model saved on the last epoch. </code></pre>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We keep only the last model from the pretraining.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's train a text classifier with <code>Spacy</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Text-classifier-with-Spacy">Text classifier with Spacy<a class="anchor-link" href="#Text-classifier-with-Spacy"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we have a pretrained model, We now need to prepare data for training the text classifier. Let's have a look at the <a href="https://spacy.io/usage/training#training-simple-style">data format</a> that Spacy expects the data to be in.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Generation">Data Generation<a class="anchor-link" href="#Data-Generation"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span><span class="p">{</span>
   <span class="nt">&quot;entities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="err">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;ORG&quot;</span><span class="err">)</span><span class="p">],</span>
   <span class="nt">&quot;heads&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">],</span>
   <span class="nt">&quot;deps&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;nsubj&quot;</span><span class="p">,</span> <span class="s2">&quot;ROOT&quot;</span><span class="p">,</span> <span class="s2">&quot;prt&quot;</span><span class="p">,</span> <span class="s2">&quot;quantmod&quot;</span><span class="p">,</span> <span class="s2">&quot;compound&quot;</span><span class="p">,</span> <span class="s2">&quot;pobj&quot;</span><span class="p">,</span> <span class="s2">&quot;det&quot;</span><span class="p">,</span> <span class="s2">&quot;npadvmod&quot;</span><span class="p">],</span>
   <span class="nt">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;PROPN&quot;</span><span class="p">,</span> <span class="s2">&quot;VERB&quot;</span><span class="p">,</span> <span class="s2">&quot;ADP&quot;</span><span class="p">,</span> <span class="s2">&quot;SYM&quot;</span><span class="p">,</span> <span class="s2">&quot;NUM&quot;</span><span class="p">,</span> <span class="s2">&quot;NUM&quot;</span><span class="p">,</span> <span class="s2">&quot;DET&quot;</span><span class="p">,</span> <span class="s2">&quot;NOUN&quot;</span><span class="p">],</span>
   <span class="nt">&quot;cats&quot;</span><span class="p">:</span> <span class="p">{</span><span class="nt">&quot;BUSINESS&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
<p>This format works for training via code, as given in the examples above, There is also another format mentioned <a href="https://spacy.io/api/annotation#json-input">here</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>cats</code> is the only part we need to worry about, this must be where they look for categories/classes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We have three classes in our dataset</p>
<ul>
<li><code>0</code> for <code>Neutral</code></li>
<li><code>1</code> for <code>Positive</code></li>
<li><code>-1</code> for <code>Negative</code></li>
</ul>
<p>and they are <strong>mutually-exclusive</strong> (There can be only one label for a sentence)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We also need to split the training data we have to training and evaluation sets so that we can see how well our model has learnt the problem.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's try to programmatically generate the training data from pandas dataframe</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">label_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;POSITIVE&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;NEGATIVE&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="s1">&#39;NEUTRAL&#39;</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need list of tuples of text and the annotation details in a dictionary as mentioned above.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_json</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Get the text from dataframe row</span>
    <span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">original_text</span><span class="p">,</span>
     <span class="p">{</span><span class="s1">&#39;cats&#39;</span><span class="p">:{</span>
            
            <span class="n">label_map</span><span class="p">[</span><span class="n">tweet</span><span class="o">.</span><span class="n">sentiment_class</span><span class="p">]:</span><span class="mf">1.0</span>
            <span class="p">}</span>
        <span class="p">})</span>
    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">train_data</span><span class="p">[[</span><span class="s1">&#39;original_text&#39;</span><span class="p">,</span> <span class="s1">&#39;sentiment_class&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Tweet&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_json</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#34;Happy #MothersDay to all you amazing mothers out there! I know it&#39;s hard not being able to see your mothers today but it&#39;s on all of us to do what we can to protect the most vulnerable members of our society. #BeatCoronaVirus &#34;,
 {&#39;cats&#39;: {&#39;NEUTRAL&#39;: 1.0}})</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we will split the training data</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="c1"># Stratified split with labels</span>
<span class="n">train_split</span><span class="p">,</span> <span class="n">eval_split</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_json</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                           <span class="n">stratify</span><span class="o">=</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">train_split</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">eval_split</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2588, 647)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We should save them as <code>json</code> files to give them as input to the command line <code>train</code> utility in spacy.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>

<span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">DRIVE_PATH</span><span class="o">/</span><span class="s1">&#39;train_clas.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">train_split</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>

<span class="k">with</span> <span class="n">Path</span><span class="p">(</span><span class="n">DRIVE_PATH</span><span class="o">/</span><span class="s1">&#39;eval_clas.json&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">eval_split</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Validate-data-input-for-spacy">Validate data input for spacy<a class="anchor-link" href="#Validate-data-input-for-spacy"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now should if we have enough data to train the model with <code>train</code> spacy command in CLI, for that I will use Spacy's <code>debug-data</code> command in CLI.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>python -m spacy debug-data -h
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>usage: spacy debug-data [-h] [-tm None] [-b None] [-p tagger,parser,ner] [-IW]
                        [-V] [-NF]
                        lang train_path dev_path

    Analyze, debug and validate your training and development data, get useful
    stats, and find problems like invalid entity annotations, cyclic
    dependencies, low data labels and more.
    

positional arguments:
  lang                  model language
  train_path            location of JSON-formatted training data
  dev_path              location of JSON-formatted development data

optional arguments:
  -h, --help            show this help message and exit
  -tm None, --tag-map-path None
                        Location of JSON-formatted tag map
  -b None, --base-model None
                        name of model to update (optional)
  -p tagger,parser,ner, --pipeline tagger,parser,ner
                        Comma-separated names of pipeline components to train
  -IW, --ignore-warnings
                        Ignore warnings, only show stats and errors
  -V, --verbose         Print additional information and explanations
  -NF, --no-format      Don&#39;t pretty-print the results
</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>%%bash
<span class="o">(</span>python -m spacy debug-data en <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/Pretrained/train_clas.json <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/Pretrained/eval_clas.json <span class="se">\</span>
    -p <span class="s1">&#39;textcat&#39;</span> <span class="se">\</span>
<span class="o">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-bold">
=========================== Data format validation ===========================</span>
<span class="ansi-green-fg">✔ Corpus is loadable</span>
<span class="ansi-bold">
=============================== Training stats ===============================</span>
Training pipeline: textcat
Starting with blank model &#39;en&#39;
0 training docs
0 evaluation docs
<span class="ansi-red-fg">✘ No evaluation docs</span>
<span class="ansi-green-fg">✔ No overlap between training and evaluation data</span>
<span class="ansi-red-fg">✘ Low number of examples to train from a blank model (0)</span>
<span class="ansi-bold">
============================== Vocab &amp; Vectors ==============================</span>
<span class="ansi-blue-fg">ℹ 0 total words in the data (0 unique)</span>
<span class="ansi-blue-fg">ℹ No word vectors present in the model</span>
<span class="ansi-bold">
============================ Text Classification ============================</span>
<span class="ansi-blue-fg">ℹ Text Classification: 0 new label(s), 0 existing label(s)</span>
<span class="ansi-blue-fg">ℹ The train data contains only instances with mutually-exclusive
classes.</span>
<span class="ansi-bold">
================================== Summary ==================================</span>
<span class="ansi-green-fg">✔ 2 checks passed</span>
<span class="ansi-red-fg">✘ 2 errors</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-Generation-(again)">Data Generation (again)<a class="anchor-link" href="#Data-Generation-(again)"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>There must be something I missed now, I asked a question on <a href="https://stackoverflow.com/q/62003962/7752347">stackoverflow</a> regarding this, turns out we need to get <code>.jsonl</code> format(again) and use the script provided in the <a href="https://github.com/explosion/spaCy/tree/master/examples/training/textcat_example_data">repo</a> to convert to the required json format for training, now I need to change the data generation a little bit to do that.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_jsonl</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># Get the text from dataframe row</span>
    <span class="p">{</span><span class="s1">&#39;text&#39;</span><span class="p">:</span> <span class="n">tweet</span><span class="o">.</span><span class="n">original_text</span><span class="p">,</span>
     <span class="s1">&#39;cats&#39;</span><span class="p">:</span> <span class="p">{</span><span class="n">v</span><span class="p">:</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">tweet</span><span class="o">.</span><span class="n">sentiment_class</span> <span class="o">==</span> <span class="n">k</span> <span class="k">else</span> <span class="mf">0.0</span>
              <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">label_map</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>

     <span class="s1">&#39;meta&#39;</span><span class="p">:{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">tweet</span><span class="o">.</span><span class="n">Index</span><span class="p">)}</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">tweet</span> <span class="ow">in</span> <span class="n">train_data</span><span class="p">[[</span><span class="s1">&#39;original_text&#39;</span><span class="p">,</span> <span class="s1">&#39;sentiment_class&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">itertuples</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Tweet&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_jsonl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;cats&#39;: {&#39;NEGATIVE&#39;: 0.0, &#39;NEUTRAL&#39;: 1.0, &#39;POSITIVE&#39;: 0.0},
 &#39;meta&#39;: {&#39;id&#39;: &#39;1.24502457848689e+18&#39;},
 &#39;text&#39;: &#34;Happy #MothersDay to all you amazing mothers out there! I know it&#39;s hard not being able to see your mothers today but it&#39;s on all of us to do what we can to protect the most vulnerable members of our society. #BeatCoronaVirus &#34;}</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So instead of a list of <code>tuples</code> now I have a list of <code>dictionaries</code>. We need to split again to have an evaluation set</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_split</span><span class="p">,</span> <span class="n">eval_split</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">train_jsonl</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                                           <span class="n">stratify</span><span class="o">=</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">train_split</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">eval_split</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(2588, 647)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We still need to convert the <code>jsonl</code> to the required <code>json</code> format, now for that I will use the script named <code>textcatjsonl_to_trainjson.py</code> in this <a href="https://github.com/explosion/spaCy/tree/master/examples/training/textcat_example_data">repo</a>. Let's download the script from the repo.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>wget -O script.py https://raw.githubusercontent.com/explosion/spaCy/master/examples/training/textcat_example_data/textcatjsonl_to_trainjson.py
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>--2020-05-30 07:44:50--  https://raw.githubusercontent.com/explosion/spaCy/master/examples/training/textcat_example_data/textcatjsonl_to_trainjson.py
Resolving raw.githubusercontent.com (raw.githubusercontent.com)... 151.101.0.133, 151.101.64.133, 151.101.128.133, ...
Connecting to raw.githubusercontent.com (raw.githubusercontent.com)|151.101.0.133|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 1542 (1.5K) [text/plain]
Saving to: ‘script.py’

script.py           100%[===================&gt;]   1.51K  --.-KB/s    in 0s      

2020-05-30 07:44:51 (17.2 MB/s) - ‘script.py’ saved [1542/1542]

</pre>
</div>
</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>%%bash
python script.py -m en /content/drive/My<span class="se">\ </span>Drive/Spacy/train_texts.jsonl /content/drive/My<span class="se">\ </span>Drive/Spacy
python script.py -m en /content/drive/My<span class="se">\ </span>Drive/Spacy/eval_texts.jsonl /content/drive/My<span class="se">\ </span>Drive/Spacy
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's try to debug again</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Validate-(again)">Validate (again)<a class="anchor-link" href="#Validate-(again)"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-bold">
=========================== Data format validation ===========================</span>
<span class="ansi-green-fg">✔ Corpus is loadable</span>
<span class="ansi-bold">
=============================== Training stats ===============================</span>
Training pipeline: textcat
Starting with blank model &#39;en&#39;
2584 training docs
647 evaluation docs
<span class="ansi-yellow-fg">⚠ 5 training examples also in evaluation data</span>
<span class="ansi-bold">
============================== Vocab &amp; Vectors ==============================</span>
<span class="ansi-blue-fg">ℹ 98859 total words in the data (10688 unique)</span>
<span class="ansi-blue-fg">ℹ No word vectors present in the model</span>
<span class="ansi-bold">
============================ Text Classification ============================</span>
<span class="ansi-blue-fg">ℹ Text Classification: 3 new label(s), 0 existing label(s)</span>
<span class="ansi-blue-fg">ℹ The train data contains only instances with mutually-exclusive
classes.</span>
<span class="ansi-bold">
================================== Summary ==================================</span>
<span class="ansi-green-fg">✔ 1 check passed</span>
<span class="ansi-yellow-fg">⚠ 1 warning</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It worked !, Thanks to the answerer of this <a href="https://stackoverflow.com/q/62003962/7752347">question</a>, now we know that our data format is correct. Turns out there is another command to <code>convert</code> our files to spacy's JSON format which is mentioned <a href="https://spacy.io/api/cli#convert">here</a>.</p>
<p>The output is pointing out that the evaluation set has some <strong>data leakage</strong>. I will try to remove that now.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">new_eval</span> <span class="o">=</span> <span class="p">[</span><span class="n">annot</span> <span class="k">for</span> <span class="n">annot</span> <span class="ow">in</span> <span class="n">eval_split</span> <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">annot</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">t</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">train_split</span><span class="p">])]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">new_eval</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">eval_split</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(641, 647)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We thought there were 5 samples leaking into the training data, it is six here, anyway let's try to validate the data again.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>%%bash
<span class="o">(</span>python -m spacy debug-data en <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/train_texts.json <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/eval_texts.json <span class="se">\</span>
    -p <span class="s1">&#39;textcat&#39;</span> <span class="se">\</span>
<span class="o">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-bold">
=========================== Data format validation ===========================</span>
<span class="ansi-green-fg">✔ Corpus is loadable</span>
<span class="ansi-bold">
=============================== Training stats ===============================</span>
Training pipeline: textcat
Starting with blank model &#39;en&#39;
2584 training docs
641 evaluation docs
<span class="ansi-green-fg">✔ No overlap between training and evaluation data</span>
<span class="ansi-bold">
============================== Vocab &amp; Vectors ==============================</span>
<span class="ansi-blue-fg">ℹ 98859 total words in the data (10688 unique)</span>
<span class="ansi-blue-fg">ℹ No word vectors present in the model</span>
<span class="ansi-bold">
============================ Text Classification ============================</span>
<span class="ansi-blue-fg">ℹ Text Classification: 3 new label(s), 0 existing label(s)</span>
<span class="ansi-blue-fg">ℹ The train data contains only instances with mutually-exclusive
classes.</span>
<span class="ansi-bold">
================================== Summary ==================================</span>
<span class="ansi-green-fg">✔ 2 checks passed</span>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We are all set to start training now!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Classifier-Training">Classifier Training<a class="anchor-link" href="#Classifier-Training"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I have made the command to train in CLI, Please refer the comments for details in the order of the arguments given here</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>%%bash
<span class="c1">## Arguement info</span>
<span class="c1"># Language of text in which the Model is going to be trained</span>
<span class="c1"># Path to store model</span>
<span class="c1"># Training data json path</span>
<span class="c1"># Evaluation data json path</span>
<span class="c1"># Pipeline components that we are going to train</span>
<span class="c1"># Number of iterations in total</span>
<span class="c1"># Nummber of iterations to wait before improvement in eval accuracy </span>
<span class="c1"># Pretrained model to start with</span>
<span class="c1"># version</span>
<span class="c1"># Augmentation for data(2 params)</span>
<span class="c1"># Model Architecture for text classifier (cnn + bow)</span>
<span class="o">(</span>python -m spacy train <span class="se">\</span>
    en <span class="se">\</span>
    -b en_core_web_sm <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/Classifier <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/train_texts.json <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/train_texts.json <span class="se">\</span>
    -p <span class="s2">&quot;textcat&quot;</span> <span class="se">\</span>
    -n <span class="m">100</span> <span class="se">\</span>
    -ne <span class="m">10</span> <span class="se">\</span>
    -t2v /content/drive/My<span class="se">\ </span>Drive/Spacy/Pretrained/fifty_iter/model49.bin <span class="se">\</span>
    -V <span class="m">0</span>.1 <span class="se">\</span>
    -nl <span class="m">0</span>.1 <span class="se">\</span>
    -ovl <span class="m">0</span>.1<span class="o">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Training pipeline: [&#39;textcat&#39;]
Starting with base model &#39;en_core_web_sm&#39;
Adding component to base model &#39;textcat&#39;
Counting training words (limit=0)
Loaded pretrained tok2vec for: []
Textcat evaluation score: F1-score macro-averaged across the labels &#39;POSITIVE,
NEGATIVE, NEUTRAL&#39;

Itn  Textcat Loss  Textcat  Token %  CPU WPS
---  ------------  -------  -------  -------
  1        26.738   39.853  100.000   177034
  2         5.179   65.120  100.000   157933
  3         1.483   76.615  100.000   178008
  4         0.686   83.266  100.000   177567
  5         0.288   86.236  100.000   169033
  6         0.151   88.381  100.000   176679
  7         0.090   90.099  100.000   166485
  8         0.057   91.000  100.000   171279
  9         0.135   92.472  100.000   175907
 10         0.028   93.237  100.000   171838
 11         0.023   94.147  100.000   175174
 12         0.022   94.729  100.000   155840
 13         0.021   95.248  100.000   161975
 14         0.021   95.485  100.000   168029
 15         0.019   95.980  100.000   161440
 16         0.018   96.226  100.000   167550
 17         0.019   96.713  100.000   172607
 18         0.017   96.849  100.000   169682
 19         0.017   97.026  100.000   167330
 20         0.015   97.299  100.000   173145
 21         0.016   97.405  100.000   173020
 22         0.015   97.526  100.000   165310
 23         0.014   97.704  100.000   165994
 24         0.013   97.865  100.000   176089
 25         0.013   98.106  100.000   172153
 26         0.013   98.201  100.000   172878
 27         0.013   98.241  100.000   175909
 28         0.012   98.320  100.000   170099
 29         0.013   98.400  100.000   175274
 30         0.012   98.481  100.000   170135
 31         0.012   98.521  100.000   164726
 32         0.011   98.536  100.000   171204
 33         0.011   98.536  100.000   163467
 34         0.011   98.576  100.000   150728
 35         0.011   98.696  100.000   172780
 36         0.010   98.735  100.000   163459
 37         0.010   98.695  100.000   162075
 38         0.010   98.750  100.000   165827
 39         0.010   98.790  100.000   165852
 40         0.010   98.830  100.000   174490
 41         0.009   98.870  100.000   165485
 42         0.010   98.990  100.000   164896
 43         0.009   99.045  100.000   172563
 44         0.008   99.045  100.000   169908
 45         0.009   99.005  100.000   152600
 46         0.008   99.084  100.000   166329
 47         0.009   99.084  100.000   173841
 48         0.008   99.164  100.000   163433
 49         0.008   99.203  100.000   162648
 50         0.008   99.258  100.000   177108
 51         0.009   99.298  100.000   173468
 52         0.008   99.298  100.000   169904
 53         0.008   99.298  100.000   171979
 54         0.008   99.298  100.000   166437
 55         0.008   99.298  100.000   170520
 56         0.007   99.337  100.000   172712
 57         0.007   99.337  100.000   174966
 58         0.007   99.392  100.000   173173
 59         0.008   99.392  100.000   173910
 60         0.007   99.392  100.000   169447
 61         0.007   99.431  100.000   161931
 62         0.007   99.471  100.000   106123
 63         0.007   99.471  100.000   177625
 64         0.007   99.511  100.000   172946
 65         0.007   99.511  100.000   173579
 66         0.007   99.511  100.000   172204
 67         0.007   99.550  100.000   172994
 68         0.006   99.550  100.000   174403
 69         0.007   99.590  100.000   173900
 70         0.006   99.630  100.000   169824
 71         0.007   99.630  100.000   171172
 72         0.006   99.669  100.000   172633
 73         0.006   99.669  100.000   159052
 74         0.007   99.669  100.000   174377
 75         0.007   99.669  100.000   163376
 76         0.006   99.669  100.000   174366
 77         0.007   99.669  100.000   175517
 78         0.007   99.669  100.000   175583
 79         0.006   99.669  100.000   174024
 80         0.006   99.669  100.000   174381
 81         0.006   99.669  100.000   177120
 82         0.006   99.708  100.000   175032
 83         0.006   99.708  100.000   173298
 84         0.007   99.708  100.000   171622
 85         0.006   99.709  100.000   163705
 86         0.006   99.709  100.000   175330
 87         0.006   99.709  100.000   178355
 88         0.006   99.709  100.000   170868
 89         0.006   99.709  100.000   164401
 90         0.005   99.709  100.000   173884
 91         0.006   99.709  100.000   159754
 92         0.006   99.709  100.000   177335
 93         0.006   99.709  100.000   169868
 94         0.006   99.709  100.000   168164
 95         0.005   99.709  100.000   151894
 96         0.006   99.709  100.000   171580
 97         0.005   99.709  100.000   169471
 98         0.005   99.724  100.000   156458
 99         0.005   99.724  100.000   168167
100         0.006   99.724  100.000   172201
<span class="ansi-green-fg">✔ Saved model to output directory</span>
/content/drive/My Drive/Spacy/Classifier/model-final
<span class="ansi-green-fg">✔ Created best model</span>
/content/drive/My Drive/Spacy/Classifier/model-best
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>                                                        
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I also tried to train without the pretrained model (ie)<code>en_core_web_sm</code>, The logs for that are here below. (Uncollapse to view), the results are not very different, the evaluation metrics are off the roof. We need to predict the test data and try to submit to the competition for a better picture of the model.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p><div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span>%%bash
<span class="c1">## Arguement info</span>
<span class="c1"># Language of text in which the Model is going to be trained</span>
<span class="c1"># Path to store model</span>
<span class="c1"># Training data json path</span>
<span class="c1"># Evaluation data json path</span>
<span class="c1"># Pipeline components that we are going to train</span>
<span class="c1"># Number of iterations in total</span>
<span class="c1"># Nummber of iterations to wait before improvement in eval accuracy </span>
<span class="c1"># Pretrained model to start with</span>
<span class="c1"># version</span>
<span class="c1"># Augmentation for data(2 params)</span>
<span class="c1"># Model Architecture for text classifier (cnn + bow)</span>
<span class="o">(</span>python -m spacy train <span class="se">\</span>
    en <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/Classifier_without_using_websm <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/train_texts.json <span class="se">\</span>
    /content/drive/My<span class="se">\ </span>Drive/Spacy/train_texts.json <span class="se">\</span>
    -p <span class="s2">&quot;textcat&quot;</span> <span class="se">\</span>
    -n <span class="m">100</span> <span class="se">\</span>
    -ne <span class="m">10</span> <span class="se">\</span>
    -t2v /content/drive/My<span class="se">\ </span>Drive/Spacy/Pretrained/fifty_iter/model49.bin <span class="se">\</span>
    -V <span class="m">0</span>.1 <span class="se">\</span>
    -nl <span class="m">0</span>.1 <span class="se">\</span>
    -ovl <span class="m">0</span>.1<span class="o">)</span>
</pre></div>

    </div>
</div>
</div>
</p>
    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre><span class="ansi-green-fg">✔ Created output directory: /content/drive/My
Drive/Spacy/Classifier_without_using_websm</span>
Training pipeline: [&#39;textcat&#39;]
Starting with blank model &#39;en&#39;
Counting training words (limit=0)
Loaded pretrained tok2vec for: []
Textcat evaluation score: F1-score macro-averaged across the labels &#39;POSITIVE,
NEGATIVE, NEUTRAL&#39;

Itn  Textcat Loss  Textcat  Token %  CPU WPS
---  ------------  -------  -------  -------
  1        26.755   40.980  100.000   166278
  2         5.293   65.846  100.000   172083
  3         1.506   76.992  100.000   175595
  4         0.695   83.314  100.000   173543
  5         0.293   86.284  100.000   172609
  6         0.156   88.784  100.000   171486
  7         0.091   90.136  100.000   161118
  8         0.056   91.761  100.000   156752
  9         0.112   92.442  100.000   167948
 10         0.028   93.329  100.000   162446
 11         0.024   94.144  100.000   165753
 12         0.022   95.206  100.000   168336
 13         0.021   95.769  100.000   161408
 14         0.020   96.150  100.000   162562
 15         0.019   96.474  100.000   163309
 16         0.018   96.775  100.000   168399
 17         0.018   97.140  100.000   169412
 18         0.017   97.357  100.000   171364
 19         0.017   97.503  100.000   172552
 20         0.016   97.584  100.000   167923
 21         0.016   97.678  100.000   168228
 22         0.015   97.934  100.000   158830
 23         0.014   98.055  100.000   170587
 24         0.013   98.216  100.000   161772
 25         0.014   98.256  100.000   160948
 26         0.013   98.296  100.000   163401
 27         0.013   98.391  100.000   168392
 28         0.012   98.351  100.000   162147
 29         0.012   98.391  100.000   171460
 30         0.012   98.511  100.000   171279
 31         0.012   98.511  100.000   161304
 32         0.011   98.511  100.000   171576
 33         0.011   98.511  100.000   171248
 34         0.011   98.591  100.000   166902
 35         0.010   98.710  100.000   164750
 36         0.011   98.830  100.000   164097
 37         0.011   98.790  100.000   170317
 38         0.010   98.790  100.000   163521
 39         0.010   98.830  100.000   162378
 40         0.009   98.964  100.000   164281
 41         0.009   98.964  100.000   173645
 42         0.011   99.004  100.000   165681
 43         0.009   99.044  100.000   165916
 44         0.009   99.044  100.000   168503
 45         0.008   99.044  100.000   166608
 46         0.008   99.123  100.000   170394
 47         0.009   99.084  100.000   171932
 48         0.008   99.124  100.000   172888
 49         0.009   99.084  100.000   169469
 50         0.009   99.084  100.000   167170
 51         0.008   99.084  100.000   169762
 52         0.008   99.124  100.000   166178
 53         0.008   99.124  100.000   161415
 54         0.008   99.164  100.000   164241
 55         0.008   99.164  100.000   172629
 56         0.008   99.164  100.000   164923
 57         0.008   99.243  100.000   160153
 58         0.007   99.243  100.000   171699
 59         0.007   99.283  100.000   165604
 60         0.008   99.323  100.000   161672
 61         0.007   99.362  100.000   157016
 62         0.007   99.417  100.000   171005
 63         0.007   99.417  100.000   168709
 64         0.007   99.417  100.000   170886
 65         0.007   99.417  100.000   164144
 66         0.007   99.417  100.000   154789
 67         0.007   99.417  100.000   162214
 68         0.006   99.457  100.000   164467
 69         0.006   99.457  100.000   169052
 70         0.006   99.496  100.000   168125
 71         0.007   99.496  100.000   164085
 72         0.006   99.575  100.000   163078
 73         0.006   99.575  100.000   162955
 74         0.006   99.575  100.000   166206
 75         0.007   99.575  100.000   164477
 76         0.006   99.575  100.000   169814
 77         0.006   99.575  100.000   162547
 78         0.006   99.575  100.000   168980
 79         0.007   99.575  100.000   172534
 80         0.006   99.575  100.000   161797
 81         0.007   99.575  100.000   162510
 82         0.006   99.575  100.000   172787
 83         0.005   99.535  100.000   159187
 84         0.006   99.535  100.000   168200
 85         0.005   99.614  100.000   167757
 86         0.006   99.614  100.000   158842
 87         0.006   99.654  100.000   166849
 88         0.005   99.654  100.000   162507
 89         0.006   99.654  100.000   167156
 90         0.005   99.654  100.000    97872
 91         0.006   99.654  100.000   162397
 92         0.006   99.708  100.000   168693
 93         0.005   99.708  100.000   167645
 94         0.005   99.708  100.000   163485
 95         0.006   99.708  100.000   171732
 96         0.005   99.708  100.000   165686
 97         0.005   99.708  100.000   167604
 98         0.005   99.708  100.000   166435
 99         0.005   99.708  100.000   161645
100         0.005   99.708  100.000   171467
<span class="ansi-green-fg">✔ Saved model to output directory</span>
/content/drive/My Drive/Spacy/Classifier_without_using_websm/model-final
<span class="ansi-green-fg">✔ Created best model</span>
/content/drive/My Drive/Spacy/Classifier_without_using_websm/model-best
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>                                                        
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Prediction-on-test-data">Prediction on test data<a class="anchor-link" href="#Prediction-on-test-data"> </a></h1>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA_PATH</span><span class="o">/</span><span class="s1">&#39;test.csv&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>original_text</th>
      <th>lang</th>
      <th>retweet_count</th>
      <th>original_author</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.246628e+18</th>
      <td>3. Yeah, I once cooked potatoes when I was 3 y...</td>
      <td>en</td>
      <td>0</td>
      <td>LToddWood</td>
    </tr>
    <tr>
      <th>1.245898e+18</th>
      <td>Happy Mother's Day to all the mums, step-mums,...</td>
      <td>en</td>
      <td>0</td>
      <td>iiarushii</td>
    </tr>
    <tr>
      <th>1.244717e+18</th>
      <td>I love the people from the UK, however, when I...</td>
      <td>en</td>
      <td>0</td>
      <td>andreaanderegg</td>
    </tr>
    <tr>
      <th>1.245730e+18</th>
      <td>Happy 81st Birthday Happy Mother’s Day to my m...</td>
      <td>en</td>
      <td>1</td>
      <td>TheBookTweeters</td>
    </tr>
    <tr>
      <th>1.244636e+18</th>
      <td>Happy Mothers day to all those wonderful mothe...</td>
      <td>en</td>
      <td>0</td>
      <td>andreaanderegg</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Clean-test-data">Clean test data<a class="anchor-link" href="#Clean-test-data"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will clean the test data of links with regex as well.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
    <span class="c1"># Regex pattern to match : the text to replace with</span>
    <span class="p">{</span><span class="s1">&#39;(https?:\/\/.*|pic.*)[</span><span class="se">\r\n</span><span class="s1">]*&#39;</span> <span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
    <span class="n">regex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_data</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1387, 4)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">list_of_test_texts</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;original_text&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's load the Spacy model from our training</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">spacy</span>
<span class="n">textcat_mod</span> <span class="o">=</span> <span class="n">spacy</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">DRIVE_PATH</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s1">&#39;Classifier/model-best&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I will try to fasten the prediction by using multithreading as mentioned <a href="https://explosion.ai/blog/multithreading-with-cython">here</a></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="n">textcat_mod</span><span class="p">(</span><span class="n">list_of_test_texts</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">d</span><span class="o">.</span><span class="n">cats</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;NEGATIVE&#39;: 0.020245620980858803,
 &#39;NEUTRAL&#39;: 0.9727445840835571,
 &#39;POSITIVE&#39;: 0.007009787950664759}</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">max</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">d</span><span class="o">.</span><span class="n">cats</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;NEUTRAL&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">label_map</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;POSITIVE&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;NEGATIVE&#39;</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;NEUTRAL&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">preds</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">textcat_mod</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">list_of_test_texts</span><span class="p">,</span> <span class="n">n_threads</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">pred_cls</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">cats</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">cats</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
    <span class="n">preds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label_map</span><span class="p">[</span><span class="n">pred_cls</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">preds</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_test_texts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1387, 1387)</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's form the submission</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sub_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
     <span class="n">preds</span><span class="p">,</span>
     <span class="n">index</span><span class="o">=</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span>
     <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sub_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(1387, 1)</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sub_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sentiment_class</th>
    </tr>
    <tr>
      <th>id</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.246628e+18</th>
      <td>0</td>
    </tr>
    <tr>
      <th>1.245898e+18</th>
      <td>0</td>
    </tr>
    <tr>
      <th>1.244717e+18</th>
      <td>-1</td>
    </tr>
    <tr>
      <th>1.245730e+18</th>
      <td>-1</td>
    </tr>
    <tr>
      <th>1.244636e+18</th>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sub_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">DRIVE_PATH</span><span class="o">.</span><span class="n">parent</span><span class="o">/</span><span class="s1">&#39;submission.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The submitted predictions scored a mere <code>39/100</code> in weighted f1-score, that's disappointing. -_-</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's analyze the predictions</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Prediction-distribution">Prediction distribution<a class="anchor-link" href="#Prediction-distribution"> </a></h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sub_df</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7fed20ed1b70&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
" />
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sub_df</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre> 0    847
 1    277
-1    263
Name: sentiment_class, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This looks very similar to the train data</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;sentiment_class&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre> 0    1701
-1     769
 1     765
Name: sentiment_class, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What would have gone wrong?, I guess what I can do is try another method(traditional). Coming up in another post</p>

</div>
</div>
</div>
</div>



      </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="mani2106/Blog-Posts"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/Blog-Posts/nlp/eda/sentiment/2020/05/30/Deep_learning_approach_for_text_classification_with_spacy.html" hidden></a>
    </main>
  </div>

  <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
  <svg class="theme-icon theme-icon-sun" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">
    <circle cx="10" cy="10" r="5" fill="currentColor"/>
    <g stroke="currentColor" stroke-width="2" stroke-linecap="round">
      <line x1="10" y1="1" x2="10" y2="3"/>
      <line x1="10" y1="17" x2="10" y2="19"/>
      <line x1="1" y1="10" x2="3" y2="10"/>
      <line x1="17" y1="10" x2="19" y2="10"/>
      <line x1="3.5" y1="3.5" x2="5" y2="5"/>
      <line x1="15" y1="15" x2="16.5" y2="16.5"/>
      <line x1="16.5" y1="3.5" x2="15" y2="5"/>
      <line x1="5" y1="15" x2="3.5" y2="16.5"/>
    </g>
  </svg>
  <svg class="theme-icon theme-icon-moon" width="20" height="20" viewBox="0 0 20 20" aria-hidden="true">
    <path d="M17 12.5A7.5 7.5 0 1 1 9.5 2a6 6 0 0 0 7.5 10.5z" fill="currentColor"/>
  </svg>
</button>

</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/Blog-Posts/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/Blog-Posts/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/Blog-Posts/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Manimaran Panneerselvam</li>
          <li><a class="u-email" href="mailto:manimaran_p@outlook.com">manimaran_p@outlook.com</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <p>This is where I write about my work on data science. I will also post Notebooks and sample codes to solve some interesting problems that I face everyday.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/mani2106" target="_blank" title="mani2106"><svg class="svg-icon grey"><use xlink:href="/Blog-Posts/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/manimaran-p" target="_blank" title="manimaran-p"><svg class="svg-icon grey"><use xlink:href="/Blog-Posts/assets/minima-social-icons.svg#linkedin"></use></svg></a></li><li><a rel="me" href="https://twitter.com/mani_maranp" target="_blank" title="mani_maranp"><svg class="svg-icon grey"><use xlink:href="/Blog-Posts/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
